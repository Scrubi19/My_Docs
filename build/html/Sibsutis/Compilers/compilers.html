

<!DOCTYPE html>
<html class="writer-html4" lang="ru" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Компиляторы &mdash; Документация My_Docs 0.0.1</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/main.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Алфавитный указатель" href="../../genindex.html" />
    <link rel="search" title="Поиск" href="../../search.html" />
    <link rel="next" title="Ruby on Rails" href="../Ruby/ruby.html" />
    <link rel="prev" title="Криптографические методы защиты информации" href="../Crypto/cryptography.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo2.svg" class="logo" alt="Логотип"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Поиск в документации" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Crypto/cryptography.html">Криптографические методы защиты информации</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Crypto/cryptography.html#id2">Глава 1. Криптосистемы с открытым ключом</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Crypto/cryptography.html#id3">Быстрое возведение в степень по модулю</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Crypto/cryptography.html#id4">Элементы теории чисел</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Crypto/cryptography.html#id5">Обобщенный алгоритм Эвклида</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Crypto/cryptography.html#id6">Система Диффи-Хеллмана</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Crypto/cryptography.html#id7">Шифр Шамира</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Crypto/cryptography.html#id8">Шифр Эль Гамаля</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Crypto/cryptography.html#rsa">Шифр RSA</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Crypto/cryptography.html#id9">Глава 2. Методы взлома шифров, основанных на дискретном логарифмировании</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Crypto/cryptography.html#id10">Метод «шаг младенца, шаг великана»</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Crypto/cryptography.html#id11">Используемая литература</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Компиляторы</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#llvm">Установка LLVM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">Инструменты и организация</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">LLVM сегодня</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Взаимодействие с драйвером компилятора</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Использование автономных инструментов</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Как это работает?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-llvm">Приемы программирования на C++ в LLVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Демонстрация расширяемого интерфейса проходов</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tablegen-td">TableGen(.td)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id10">Анализатор исходного кода</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id11">Лексический анализ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#clang-libtoling">Инструменты Clang и фреймворк LibToling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#clang-tidy">Clang-tidy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clang-modernizer">Clang Modernizer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id12">Используемая литература</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Ruby/ruby.html">Ruby on Rails</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Ruby/ruby.html#ubuntu">Установка на Ubuntu</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Sql/sql.html">Базы данных</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">My_Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Компиляторы</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/Sibsutis/Compilers/compilers.rst.txt" rel="nofollow"> Просмотреть исходный код страницы</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>Компиляторы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h1>
<div class="section" id="llvm">
<h2>Установка LLVM<a class="headerlink" href="#llvm" title="Ссылка на этот заголовок">¶</a></h2>
<ul class="simple">
<li>Склонировать репозиторий с LLVM:</li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">llvm</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Конфигурирование сборочных файлов:</li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">llvm</span><span class="o">-</span><span class="n">project</span>

<span class="n">mkdir</span> <span class="n">build</span>

<span class="n">cd</span> <span class="n">build</span>

<span class="n">cmake</span> <span class="o">-</span><span class="n">G</span> <span class="o">&lt;</span><span class="n">generator</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> <span class="o">../</span><span class="n">llvm</span>
</pre></div>
</div>
<p>Generators:</p>
<blockquote>
<div><p>Ninja — для генерации ninja-build сборочных файлов</p>
<p>Unix Makefiles — для генерации make поддерживающих parallel makefiles</p>
<p>Visual Studio — for generating Visual Studio projects and solutions</p>
<p>Xcode — for generating Xcode projects</p>
</div></blockquote>
<p>Options:</p>
<blockquote>
<div><p>-DLLVM_ENABLE_PROJECTS = „…“ — semicolon-separated list of the LLVM subprojects you’d like to additionally build. Can include any of: clang, clang-tools-extra, libcxx, libcxxabi, libunwind, lldb, compiler-rt, lld, polly, or debuginfo-tests</p>
<p><em>For example</em> : -DLLVM_ENABLE_PROJECTS=»clang;libcxx;libcxxabi»</p>
<p>-DCMAKE_INSTALL_PREFIX=directory — Specify for directory the full pathname of where you want the LLVM tools and libraries to be installed (default /usr/local)</p>
<p>-DCMAKE_BUILD_TYPE=type — Valid options for type are Debug, Release, RelWithDebInfo, and MinSizeRel. Default is Debug.</p>
<p>-DLLVM_ENABLE_ASSERTIONS=On — Compile with assertion checks enabled (default is Yes for Debug builds, No for all other build types)</p>
</div></blockquote>
</div></blockquote>
<ul class="simple">
<li>Запуск сборки:</li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">--</span><span class="n">build</span> <span class="o">.</span>
<span class="n">cmake</span> <span class="o">--</span><span class="n">build</span> <span class="o">--</span><span class="n">target</span> <span class="n">install</span>
</pre></div>
</div>
</div></blockquote>
<p>Примечания:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Собирать на каком-либо теге</li>
<li>Можно выкачивать не весь репозиторий, см. опцию - -depth в гите</li>
<li>При сборке нужно включить проект clang в -DLLVM_ENABLE_PROJECTS</li>
<li>Собирать Debug версию (по умолчанию)</li>
<li>Для сборки мне понадоби лось 8 GB Ram + 50 GB файлов подкачки + 70 GB свободного места</li>
<li>Требуется cmake &gt;= 3.13.4, python &gt;= 2.7, gcc &gt;= 5.1.0, ninja-build</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="id2">
<h2>Инструменты и организация<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h2>
<p>Проект LLVM включает несколько библиотек и инструментов, которые, все вместе, образуют больщую инфраструктуру компилятора. Философия LLVM «все сущее есть библиотека». Это фреймворк со множеством инструментов позволяющий изучать/проходить все стадии компиляции</p>
<p><strong>10 лет тому назад</strong> реализация, в значительной степени состоящая из алгоритмов трансляции в машинный код, опиралась на GCC, для трансляции программ в промежуточное представление LLVM (IR)</p>
<p>В философии LLVM есть важный аспект, компилятор (clang) не применяет оптимизаций во время компиляции, оставляя возможность выполнения оптимизаций в то время, когда программа не работает (н: во время компоновки)</p>
<p><strong>Конкуренция с Java</strong>  Для поддержки оптимизации на всем жизненном цикле программы необходимо их распространение в формате LLVM IR, это предполагает работу LLVM как виртуальной машины и конкуренцию с Java</p>
<p><strong>Но</strong> LLVM IR(внутреннее представление) не является системно-независимой, к тому же в LLVM отсутствует оптимизация с обратной связью</p>
<div class="section" id="id3">
<h3>LLVM сегодня<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h3>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/structure.png"><img alt="../../_images/structure.png" src="../../_images/structure.png" style="width: 600px;" /></a>
</div>
<p>Части инфраструктуры:</p>
<blockquote>
<div><ul class="simple">
<li><strong>Анализатор исходного кода (frontend «clang»):</strong> Компилятор, выполняющий этап трансляции программ на языках C, C++,.. в промежуточное представление LLVM IR. Включает лексический, синтаксический и семантический анализаторы, а также генератор кода LLVM IR</li>
<li><strong>Промежуточное представление (IR):</strong> Промежуточное представление LLVM IR имеет две формы: удобночитаемую текстовую форму и двоичную</li>
<li><strong>Генератор выполняемого кода (backend «asm, JIT»):</strong> Компилятор, преобразующий промежуточное представление LLVM IR программы в конкретный код на языке ассемблера для заданной архитектуры или в двоичный объектный код.</li>
</ul>
</div></blockquote>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/deep_structure.png"><img alt="../../_images/deep_structure.png" src="../../_images/deep_structure.png" style="width: 600px;" /></a>
</div>
<p>Все компоненты компилятора взаимодействуют друг с другом 2-мя способами:</p>
<blockquote>
<div><ol class="arabic simple">
<li><strong>Через структуры в памяти:</strong> Clang использует каждый компонент LLVM как библиотеку и опирается на структуру данных в памяти</li>
<li><strong>Через файлы:</strong> Пользователь запускает отдельные инструменты и использует их выходные файлы как входные файлы для последующих инструментов</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="id4">
<h3>Взаимодействие с драйвером компилятора<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h3>
<p>Драйвер компилятора можно сравнить с официантом в ресторане, он принимает ваш заказ, передёт его повару и затем приносит готовое блюдо. В LLVM и Clang функции драйвера компилятора выполняет инструмент <em>clang</em></p>
<p>Чтобы увидеть, какие инструменты вызываются драйвером, добавьте команду-аргумент -###</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>clang -### hello.c -o hello
clang version <span class="m">3</span>.4 <span class="o">(</span>tags/RELEASE_34/final <span class="m">211335</span><span class="o">)</span>
Target: i386-pc-linux-gui
Thread model: posix
“clang” “-cc1” <span class="o">(</span>...parameters<span class="o">)</span> “hello.c” “-o” “/tmp/hello-dddafc1.o”
“/usr/bin/ld” <span class="o">(</span>...parameters<span class="o">)</span> “/tmp/hello-dddafc1.o” “-o” “hello”
</pre></div>
</div>
<ul class="simple">
<li>clang -cc1 реализует весь цикл компиляции</li>
</ul>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/clang.png"><img alt="../../_images/clang.png" src="../../_images/clang.png" style="width: 600px;" /></a>
</div>
</div>
<div class="section" id="id5">
<h3>Использование автономных инструментов<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h3>
<p>Тот же самый процесс компиляции, можно выполнить с использованием автономных инструментов LLVM, передавая вывод одного инструмента на ввод другого. Скорость компиляции уменьшится, но появляется возможность тонкой настройки параметров промежуточных инструментов:</p>
<blockquote>
<div><ul class="simple">
<li><strong>opt:</strong> выполняет оптимизацию программы на уровне промежуточного представления IR. На входе файл с биткодом, на выходе файл того же типа</li>
<li><strong>llc:</strong> выполняет преобразование биткода в исходный текст на языке ассемблера для данной архитектуры. Принимает аргументы, опредеяющие уровень оптимизации</li>
<li><strong>llvm-mc:</strong> выполняет трансляцию ассемблерного кода и может создавать объектные файлы (ELF, Mach, PE). Может также дизассемблировать файлы, приводя ассемблерный код во внутренние конструкции LLVM</li>
<li><strong>lli:</strong> реализует интепретатор и JIT компилятор для IR</li>
<li><em>llvm-link:</em> выполняет компоновку нескольких файлов с биткодом в один большой файл с биткодом LLVM</li>
<li><strong>llvm-as:</strong> преобразует файлы с промежуточными представлением IR в текстовом виде (сборки LLVM), в файлы с биткодом LLVM</li>
<li><strong>llvm-dis:</strong> декодирует биткод LLVM в сборки LLVM</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id6">
<h3>Как это работает?<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// main.c</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">sum</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;r = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// sum.c</span>

<span class="kt">int</span> <span class="nf">sum</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. можно скомпилировать все одной командой:</span>
clang main.c sum.c -o sum

<span class="c1"># 2.1 Тот же результат можно получить с помощью автономных инструментов:</span>
clang -emit-llvm -c main.c -o main.bc // получение биткод формы
clang -emit-llvm -c sum.c -o sum.bc   // или
clang -emit-llvm -S main.c -o main.ll // получение читаемой формы
clang -emit-llvm -S sum.c -o sum.ll

<span class="c1"># 2.2a Преобразовать биткод в объектные файлы, далее создать исполняемый файл путем компоновки</span>
llc -filetype<span class="o">=</span>obj main.bc -o main.o
llc -filetype<span class="o">=</span>obj sum.bc -o main.o
clang main.o sum.o -o sum

<span class="c1"># 2.2b Сначала скомпоновать файлы с биткодом в 1 файл, затем преобразовать его в объектный файл</span>
<span class="c1"># и из него получить исполняемый файл</span>
llvm-link main.bc sum.bc -o sum.linked.bc
llc -filetype<span class="o">=</span>obj sum.linked.bc -o sum.linked.o
clang sum.linked.o -o sum
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/llvm-o.png"><img alt="../../_images/llvm-o.png" src="../../_images/llvm-o.png" style="width: 600px;" /></a>
</div>
</div>
<div class="section" id="c-llvm">
<h3>Приемы программирования на C++ в LLVM<a class="headerlink" href="#c-llvm" title="Ссылка на этот заголовок">¶</a></h3>
<p>Библиотеки и инструменты LLVM написаны на языке C++ с использованием преимуществ ООП (Полиморфизма, Наследования, Инкапсуляции), а также шаблонов (template). C полным списком эффективных приемов программирования на C++, используемых в LLVM можно ознакомиться <a class="reference external" href="http://llvm.org/docs/CodingStandards.html">здесь</a></p>
</div>
<div class="section" id="id8">
<h3>Демонстрация расширяемого интерфейса проходов<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h3>
<p>Под «проходом» в данном случае понимается анализ преобразования или оптимизации. LLVM API позволяет регистрировать собственные проходы на разных этапах компиляции. Регистрация проходов выполняются с помощью диспетчера проходов <em>PassManager</em></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="n">X86PassConfig</span><span class="o">::</span><span class="n">addPreEmitPass</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">getOptLevel</span><span class="p">()</span> <span class="o">!=</span> <span class="n">CodeGenOpt</span><span class="o">::</span><span class="n">None</span> <span class="o">&amp;&amp;</span> <span class="n">getX86Subtarget</span><span class="p">().</span><span class="n">hasSSE2</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">addPass</span><span class="p">(</span><span class="n">createExecutionDependencyFixPass</span><span class="p">(</span><span class="o">&amp;</span><span class="n">X86</span><span class="o">::</span><span class="n">VR128RegClass</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="n">getOptLevel</span><span class="p">()</span> <span class="o">!=</span> <span class="n">CodeGenOpt</span><span class="o">::</span><span class="n">None</span> <span class="o">&amp;&amp;</span>
    <span class="n">getX86Subtarget</span><span class="p">().</span><span class="n">padShortFunctions</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">addPass</span><span class="p">(</span><span class="n">createX86PadShortFunctions</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="tablegen-td">
<h3>TableGen(.td)<a class="headerlink" href="#tablegen-td" title="Ссылка на этот заголовок">¶</a></h3>
<p>Инструмент LLVM, используемый системой сборки, что бы сгенерировать программный код с++ для тех частей компилятора, которые могут быть синтезированы механическим способом</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>//DiagnosticRarseKinds.td
def err_invalid_sign_spec: Error&lt;”’%0’ cannot be signed or unsigned”&gt;<span class="p">;</span>
def err_invalid_short_spec: Error&lt;”’short %0’ is invalid”&gt;<span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Цель TableGen - помочь человеку разрабатывать и поддерживать
записи информации о предметной области. Поскольку таких
записей может быть большое количество, он специально
разработан, чтобы позволить писать гибкие описания и
вычеркивать общие особенности этих записей. Это уменьшает
количество дублирования в описании, снижает вероятность
ошибки и упрощает структурирование информации, относящейся
к предметной области.
Основная часть TableGen анализирует файл, создает экземпляры
объявлений и передает результат на обработку в «бэкэнд
TableGen», зависящий от домена. В настоящее время основным
пользователем TableGen является генератор кода LLVM. В случае каких либо вопросов обращайтесь к <a class="reference external" href="https://releases.llvm.org/9.0.0/docs/TableGen/LangRef.html">документации</a></p>
</div>
</div>
</div>
<div class="section" id="id10">
<h2>Анализатор исходного кода<a class="headerlink" href="#id10" title="Ссылка на этот заголовок">¶</a></h2>
<p>Подобно названию LLVM, имеющему несколько значений, название Clang также может использоваться в трех разных смыслах:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Анализатор исходного кода</li>
<li>Драйвер компилятора</li>
<li>Фактический компилятор (clang -cc1)</li>
</ol>
</div></blockquote>
<p>Инструмент clang -cc1 имеет специальный параметр для вывода абстрактного синтаксического дерева (AST)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>clang -Xclang -ast-dump hello.c
<span class="c1"># или</span>
clang -сс1 -ast-dump hello.c
</pre></div>
</div>
<p>Библиотеки libclang:</p>
<blockquote>
<div><ul class="simple">
<li><strong>linclangLex</strong>: используется для предварительной обработки и лексического анализа</li>
<li><strong>libclangAST</strong>: содержит функции для построения и управления абстрактных синтаксических деревьев</li>
<li><strong>libclangParse</strong>: используется для парсинга результатов фазы лексического анализа</li>
<li><strong>libclangSema</strong>: используется для семантического анализа</li>
<li><strong>libclangCodeGen</strong>: генерирует код промежуточного представления LLVM IR с использованием информации о целевой архитектуре</li>
<li><strong>libclangAnalysis</strong>: содержит ресурсы для статического анализа</li>
<li><strong>libclangRewrite</strong>: содержит инфраструктуру для реализации инструментов рефакторинга кода</li>
<li><strong>libclangBasic</strong>: содержит множество утилит - абстракции управлния памятью, поиск источников данных и диагностика</li>
</ul>
</div></blockquote>
<div class="section" id="id11">
<h3>Лексический анализ<a class="headerlink" href="#id11" title="Ссылка на этот заголовок">¶</a></h3>
<p>На самом первом этапе анализатор исходного кода разбивает языковые конструкции в текстовом формате на множество слов и лексем, удаляя такие элементы программы, как комментарии, пробелы и табуляции. Каждое слово должно принадлежать подможеству языка, а каждое зарезервированное слово преобразуется во внутреннее представление компилятора. Зарезервированные слова определены в файле <em>include/clang/Basic/TokenKinds.def</em> (Определения помещаются в пространство имён tok.т.е доступ к ним можно получить например: <strong>tok::l_brace</strong> и тд)</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// C99 6.4.2: Identifiers.</span>
<span class="n">TOK</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span> <span class="c1">// abcde123</span>
<span class="c1">// C++11 String Literals.</span>
<span class="n">TOK</span><span class="p">(</span><span class="n">utf32_string_literal</span><span class="p">)</span><span class="c1">// U&quot;foo&quot;</span>

<span class="n">PUNCTUATOR</span><span class="p">(</span><span class="n">r_paren</span><span class="p">,</span><span class="s">&quot;)&quot;</span><span class="p">)</span>
<span class="n">PUNCTUATOR</span><span class="p">(</span><span class="n">l_brace</span><span class="p">,</span><span class="s">&quot;{&quot;</span><span class="p">)</span>
<span class="n">PUNCTUATOR</span><span class="p">(</span><span class="n">less</span><span class="p">,</span> <span class="s">&quot;&lt;&quot;</span><span class="p">)</span>
<span class="n">KEYWORD</span><span class="p">(</span><span class="k">while</span><span class="p">,</span> <span class="n">KEYALL</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="clang-libtoling">
<h2>Инструменты Clang и фреймворк LibToling<a class="headerlink" href="#clang-libtoling" title="Ссылка на этот заголовок">¶</a></h2>
<p>Инструменты Clang опираются на фреймворк LibToling, библиотеку Clang, которая может служить основой для создания автономных интсрументов</p>
<p>Инструменты на базе libTooling:</p>
<blockquote>
<div><ul class="simple">
<li>Clang Tidy</li>
<li>Clang Modernizer</li>
<li>Clang Apply Replacements</li>
<li>ClangFormat</li>
<li>Modularize</li>
<li>PPTrace</li>
<li>Clang Query</li>
</ul>
</div></blockquote>
<div class="section" id="clang-tidy">
<h3>Clang-tidy<a class="headerlink" href="#clang-tidy" title="Ссылка на этот заголовок">¶</a></h3>
<p>Данный инструмент проверяет наличие в исходном коде распространенных нарушений
стандартов оформления в том числе. Инструмент просматривает дерево AST и действует намного быстрее. В отличие от средств проверки в составе статического анализатора Clang, проверки написанные для clang-tidy, обычно нацелены на определения соответствия или несоответствия определенным соглашениям по оформлению исходного кода:</p>
<blockquote>
<div><ul class="simple">
<li>Переносимость кода между разными компиляторами;</li>
<li>Следование определенным идиомам;</li>
<li>Возможность появления ошибок из-за злоупотребления опасными особенностями языка</li>
</ul>
</div></blockquote>
<p>Проверка исходного кода с помощью Clang-tidy:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>clang-tidy <span class="o">[</span>параметры<span class="o">]</span> <span class="o">[</span>&lt;файл0&gt;..&lt;файлN&gt;<span class="o">]</span> <span class="o">[</span>--команды компилятора<span class="o">]</span>
<span class="c1"># можно воспользоваться * в параметре -checks для запуска множества проверок</span>
clang-tidy -checks<span class="o">=</span><span class="s2">&quot;llvm-*&quot;</span> file.cpp
</pre></div>
</div>
<p>Так как наш код компилируется вместе с Clang, нам потребуется база данных команды компиляции. Поэтому начнем с её создания. Перейдите в каталог, где находятся исходные тексты LLVM, и создайте отдельный каталог для хранения файлов CMake</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir cmake-scripts
<span class="nb">cd</span> cmake-scripts
cmake -DCMAKE_EXPORT_COMPILE_COMMANDS<span class="o">=</span>ON ../llvm
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Совет</p>
<p class="last">Если вы столкнетесь с ошибкой, сообщающей о неизвестном исходном файле и          ссылающейся на файл с реализацией нашего средства проверки, созданный в прерыдущей главе, просто добавьте имя этого файла в <em>CMakeLists.txt</em>. Для этого выполните следующую команду и запустите CMake еще раз</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim ../llvm/tools/clang/lib/StaticAnalyzer/Checkers/CMakeLists.txt
</pre></div>
</div>
<p>Затем в корневом каталоге LLVM создайте ссылку на файл базы данных команд компиляции</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ln -s <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/compile_commands.json ../llvm
<span class="c1"># Теперь можно вызвать сам инструмент</span>
<span class="nb">cd</span> ../llvm/tools/clang/lib/StaticAnalyzer/Checkers
clang-tidy -checks<span class="o">=</span><span class="s2">&quot;llvm-*&quot;</span> ReactorChecker.cpp
</pre></div>
</div>
<p>Пример по использованию clang-tidy:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>clang-tidy test.cpp --fix-errors --fix
-checks<span class="o">=</span>bugprone-*,cppcoreguidelines-*,misc-*,modernize-*,performance-*,readability-* --
</pre></div>
</div>
<p>Было:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>
int main<span class="o">()</span> <span class="o">{</span>
  int i<span class="p">;</span>
  <span class="nb">printf</span> <span class="o">(</span>“%d”, i<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Стало:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp"></span>
<span class="k">auto</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">int</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="clang-modernizer">
<h3>Clang Modernizer<a class="headerlink" href="#clang-modernizer" title="Ссылка на этот заголовок">¶</a></h3>
</div>
</div>
<div class="section" id="id12">
<h2>Используемая литература<a class="headerlink" href="#id12" title="Ссылка на этот заголовок">¶</a></h2>
<p><a class="reference external" href="LLVMbook.pdf">LLVM. Инфраструктура для разработки компиляторов</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Авторские права 2020, Bulatov Alexandr

    </p>
  </div>
    
    
    
    Собрано при помощи <a href="http://sphinx-doc.org/">Sphinx</a> с использованием
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">темы,</a>
    
    предоставленной <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>