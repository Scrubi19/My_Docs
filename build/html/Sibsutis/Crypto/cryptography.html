

<!DOCTYPE html>
<html class="writer-html5" lang="ru" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Криптографические методы защиты информации &mdash; Документация My_Docs 0.0.1</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/main.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/translations.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Алфавитный указатель" href="../../genindex.html" />
    <link rel="search" title="Поиск" href="../../search.html" />
    <link rel="next" title="LLVM: инфраструктура для разработки компилятора" href="../Compilers/llvm.html" />
    <link rel="prev" title="Шпаргалки" href="../Cheat_sheets/cheat.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo2.svg" class="logo" alt="Логотип"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Поиск в документации" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Cheat_sheets/cheat.html">Шпаргалки</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Cheat_sheets/cheat.html#git">Git</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Cheat_sheets/cheat.html#id2">Создание репозитория</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Cheat_sheets/cheat.html#id3">Команды</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Cheat_sheets/cheat.html#gitignore">Памятка по .gitignore</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Cheat_sheets/cheat.html#bash">BASH</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Cheat_sheets/cheat.html#id5">Команды</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Cheat_sheets/cheat.html#id6">Переменные и параметры скрипта</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Cheat_sheets/cheat.html#id7">Зарезервированные переменные</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Cheat_sheets/cheat.html#id8">Условия</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Криптографические методы защиты информации</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">Глава 1. Криптосистемы с открытым ключом</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">Быстрое возведение в степень по модулю</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Элементы теории чисел</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Обобщенный алгоритм Эвклида</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Система Диффи-Хеллмана</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">Шифр Шамира</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Шифр Эль Гамаля</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rsa">Шифр RSA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">Шифр Вернама</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id10">Глава 2. Методы взлома шифров, основанных на дискретном логарифмировании</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id11">Метод «шаг младенца, шаг великана»</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id12">Глава 3. Электронная, или цифровая подпись</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id13">Электронная подпись RSA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">Электронная подпись на базе шифра Эль-Гамаля</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">Стандарты на цифровую подпись (ГОСТ Р34.10-94)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id16">Глава 5. Криптографические протоколы</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id17">Ментальный покер(Пример на основе двух пользователей)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">Многопользовательный ментальный покер</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id19">Электронные деньги (Слепая подпись)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id20">Протокол доказательства с нулевым знанием для задачи «Гамильтонов цикл»</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id21">Доказательство с нулевым знанием</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id22">Гамильтонов цикл</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23">Ход алгоритма</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id24">Используемая литература</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Compilers/llvm.html">LLVM: инфраструктура для разработки компилятора</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Compilers/llvm.html#id1">Установка LLVM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compilers/llvm.html#id2">Инструменты и организация</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#id3">LLVM сегодня</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#id4">Взаимодействие с драйвером компилятора</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#id5">Использование автономных инструментов</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#id6">Как это работает?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#c-llvm">Приемы программирования на C++ в LLVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#id8">Демонстрация расширяемого интерфейса проходов</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#tablegen-td">TableGen(.td)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Compilers/llvm.html#id10">Анализатор исходного кода</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#id11">Лексический анализ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Compilers/llvm.html#clang-libtoling">Инструменты Clang и фреймворк LibToling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#clang-tidy">Clang-tidy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#clang-modernizer">Clang Modernizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#clang-apply-replacements">Clang Apply Replacements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#clangformat">ClangFormat</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#modularize">Modularize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#module-map-checker">Module Map Checker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#pptrace">PPTrace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#clang-query">Clang-Query</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#clang-check">Clang-Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#c-str">Удаление вызовов c_str() «Самый маленький инструмент для рефакторинга»</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Compilers/llvm.html#libclang">Создание собственного инструмента (libclang)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compilers/llvm.html#llvm-ir">LLVM IR</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#ll">Содержание .ll файла</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#id12">Определение функций в .ll</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#id13">Атрибуты</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Compilers/llvm.html#id14">Инструкции</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Compilers/llvm.html#id15">Оптимизации времени компиляции и времени компоновки</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compilers/llvm.html#id16">Используемая литература</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Ruby/ruby.html">Ruby on Rails</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Ruby/ruby.html#ubuntu">Установка на Ubuntu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Ruby/ruby.html#id1">Начало</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Databases/Databases.html">Базы данных</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Databases/Databases.html#id2">Реляционные базы данных. Операции в реляционной алгебре</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Databases/Databases.html#id3">Выборка</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Databases/Databases.html#id4">Проекция</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Databases/Databases.html#id5">Соединение и естественное соединение</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Databases/Databases.html#id6">Объединение</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Databases/Databases.html#id7">Пересечение</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Databases/Databases.html#id8">Удаление</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Databases/Databases.html#id9">Декартово произведение</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Databases/Databases.html#mysql">Установка MySQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Databases/Databases.html#id10">Основы MySQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Databases/Databases.html#sql">Типы данных SQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Databases/Databases.html#id12">Используемая литература</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">My_Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Криптографические методы защиты информации</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/Sibsutis/Crypto/cryptography.rst.txt" rel="nofollow"> Просмотреть исходный код страницы</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>Криптографические методы защиты информации<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h1>
<div class="section" id="id2">
<h2>Глава 1. Криптосистемы с открытым ключом<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="id3">
<h3>Быстрое возведение в степень по модулю<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h3>
<p>Односторонняя функция (англ. one-way function, OWF) -   математическая функция, которая легко вычисляется для любого входного значения, но трудно найти аргумент по заданному значению функции. В криптографических задачах в качестве односторонней функции часто используется функция:</p>
<div class="math notranslate nohighlight">
\[{ y = a^{x}\bmod p }\]</div>
<p>Обратная функция называется дискретным логарифмом и является трудновычислимой:</p>
<div class="math notranslate nohighlight">
\[{ x = log_a(y)\bmod p }\]</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/2.1.png"><img alt="table" src="../../_images/2.1.png" style="width: 650px;" /></a>
</div>
<p>Перейдем к описанию алгоритма быстрого возведения числа в степень по модулю. Любое десятичное число может быть представлено в виде полинома степеней двойки</p>
<div class="math notranslate nohighlight">
\[x = x_02^{0} + x_12^{1}+ ...+x_t2^{t}\]</div>
<p>Описание хода вычислений алгоритма:</p>
<div class="math notranslate nohighlight">
\[\begin{split}a^{x} \bmod m = y \\
23^{15} \bmod 17 = ?\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}15_{10} = 1111_2 = 2^{0}+2^{1}+2^{2}+2^{3} =&gt; \quad 23^{15} = 23^{2^{0}+2^{1}+2^{2}+2^{3}} \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}(23^{2^{0}} * 23^{2^{1}} * 23^{2^{2}} * 23^{2^{3}}) \bmod 17 = y  \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}(23^{2^{0}} \bmod 17 * 23^{2^{1}} \bmod 17 * 23^{2^{2}} \bmod 17 * 23^{2^{3}} \bmod 17) \bmod 17 = y \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}1) 23^{2^{0}} \bmod 17 &amp;= 6 \quad 23^{2^{1}} = 23^{2^{0}} * 23^{2^{0}} \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}2) 23^{2^{1}} \bmod 17 = ((23^{2^{0}} \bmod 17 )*(23^{2^{0}} \bmod 17)) \bmod 17 &amp;= (6 * 6) \bmod 17 = 36 \bmod 17 = 2 \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}3) 23^{2^{2}} \bmod 17 = ((23^{2^{1}} \bmod 17 )*(23^{2^{1}} \bmod 17)) \bmod 17 &amp;= (2*2) \bmod 17 = 4 \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}4)23^{2^{3}} \bmod 17 = ((23^{2^{2}} \bmod 17 )*(23^{2^{2}} \bmod 17)) \bmod 17 &amp;= (4*4) \bmod 17 = 16 \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}Ответ: 23^{15} \bmod 17 = (6*2*4*16) \bmod 17 = 3 \\\end{split}\]</div>
<p>Листинг программы:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">calculate</span><span class="p">(</span> <span class="kt">long</span> <span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">x</span><span class="p">,</span> <span class="kt">long</span> <span class="n">p</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kt">long</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Negative numbers and p=0 are not supported&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">while</span><span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span><span class="o">%</span><span class="n">p</span><span class="p">;</span>
                <span class="n">t</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">;</span>
            <span class="n">x</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
<span class="c1">//            System.out.println(&quot;\nNumber of Iteration = &quot;+t);</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p>Количество операций умножения при вычислении по описанному методу не превосходит <em>2log x</em></p>
</div>
<div class="admonition attention">
<p class="admonition-title">Внимание</p>
<p><strong>Доказательство</strong>: Для вычисления чисел ряда требуется t умножений,     для вычисления y не более, чем t умножений. Из условия <em>t = [log x]</em> , учитывая,   что <em>log x ≤ log x</em>, делаем вывод о справедливости доказываемого утверждения</p>
</div>
</div>
<div class="section" id="id4">
<h3>Элементы теории чисел<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h3>
<ul class="simple">
<li><p>Число называется простым, если оно не делится ни на какое другое число, кроме самого себя и единицы (11, 23)</p></li>
<li><p>Любое целое положительное число  может быть представлено в виде произведения простых чисел, причем единственным образом (27 = 3*3 * 3,33)</p></li>
<li><p>Два числа называются взаимно простыми если они не имеют ни одного общего делителя кроме единицы (27 и 28)</p></li>
<li><p><strong>Функция Эйлера</strong>. Пусть дано целое число N &gt;= 1. Значение функции Эйлера ф(N) равно количеству чисел в ряду 1,2,3, … ,N - 1, взаимно простых с N</p></li>
</ul>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/2.2.png"><img alt="phi" src="../../_images/2.2.png" style="width: 600px;" /></a>
</div>
<ul class="simple">
<li><p>Если p-простое число, то <span class="math notranslate nohighlight">\(\quad \varphi(p) = p - 1 \\\)</span></p></li>
<li><p>Если p и q - два различных простых числа ( p != q). Тогда</p></li>
</ul>
</div></blockquote>
<div class="math notranslate nohighlight">
\[{ \varphi(pq) = (p-1)(q-1)}\]</div>
<ul class="simple">
<li><p><strong>Теорема Ферма</strong>. Пусть p - простое число и 0 &lt; a &lt; p. Тогда</p></li>
</ul>
<div class="math notranslate nohighlight">
\[{ a^{p-1}\bmod p = 1 }\]</div>
<ul class="simple">
<li><p><strong>Теорема Эйлера</strong>. Пусть a и b - взаимно простые числа. Тогда</p></li>
</ul>
<div class="math notranslate nohighlight">
\[{ a^{\varphi(b)}\bmod b = 1 }\]</div>
</div>
<div class="section" id="id5">
<h3>Обобщенный алгоритм Эвклида<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h3>
<p>Пусть a и b — два целых положительных числа. Наибольший общий делитель чисел a и b есть наибольшее число c, которое делит и a и b :</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[{ c = gcd(a, b) }\]</div>
</div></blockquote>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/gcd.png"><img alt="gcd" src="../../_images/gcd.png" style="width: 600px;" /></a>
</div>
<p>Пусть a и b — два целых положительных числа. Тогда существуют целые (не обязательно положительные) числа x и y , такие, что</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[{ ax + by = gcd(a, b) }\]</div>
</div></blockquote>
<p>Введем три строки <span class="math notranslate nohighlight">\(U = (u_1 , u_2 , u_3 ), V = (v_1 , v_2 , v_3 ), T = (t_1 , t_2 , t_3 )\)</span>. Тогда алгоритм записывается следующим образом:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/Euclid.png"><img alt="Euclid" src="../../_images/Euclid.png" style="width: 600px;" /></a>
</div>
<p>Описание хода вычислений алгоритма:</p>
<div class="math notranslate nohighlight">
\[\begin{split}Euclid(17, 9) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}ax + by = gcd(a,b) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}U(a, 1, 0) \quad  V(b, 0, 1) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}1) q = U1 \ div \  V1 = 1\\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}T = (U1 \bmod V1; U2 - qV2; U3 - qV3 ) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}T = (8, 1, -1) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}U = V, V = T \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}U = (9,0,1) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}V = (8,1,-1) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}2)q = 1 \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}T = (1, -1, 2) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}U = (8,1,-1) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}V = (1,-1,2) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}3)q = 8 \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}T = (0, -9,-17) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}U = (1,-1,2) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}V = (0,9,-17) \\\\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}Когда \ V1 = 0, тогда \ в \ U \ лежат \ ответы \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}gcd(a,b) = 1, \ x = -1, \ y = 2 \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}17*(-1) + 9*2 = 1 \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}-17+18 = 1 \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}1 = 1 \\\end{split}\]</div>
<p>Листинг программы:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span><span class="o">[]</span> <span class="nf">calculate</span><span class="p">(</span><span class="kt">long</span> <span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">long</span> <span class="n">temp</span><span class="p">;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">long</span><span class="o">[]</span> <span class="n">U</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">long</span><span class="o">[]</span><span class="p">{</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
    <span class="kt">long</span><span class="o">[]</span> <span class="n">V</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">long</span><span class="o">[]</span><span class="p">{</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">};</span>
    <span class="kt">long</span><span class="o">[]</span> <span class="n">T</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">long</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">q</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">V</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">U</span><span class="o">[</span><span class="mi">0</span><span class="o">]/</span><span class="n">V</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
        <span class="n">T</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">U</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">%</span> <span class="n">V</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
        <span class="n">T</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">U</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">V</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
        <span class="n">T</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="n">U</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">V</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">U</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">V</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
            <span class="n">V</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">T</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">U</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Система Диффи-Хеллмана<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h3>
<p>Эта криптосистема была открыта в середине 70-х годов американскими учеными Диффи (Whitfield Diffie) и Хеллманом (Martin Hellman) и привела к настоящей революции в криптографии и ее практических применениях. Для обеспечения высокой стойкости рассмотренной системы число p-1 должно обязательно содержать большой простой множитель. Рекомендуют использовать следующее:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[P = 2Q + 1 , \ где \ Q - простое \ число\]</div>
</div></blockquote>
<p>Для Q должны выполняться условия:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[{ 1 &lt; G &lt; P − 1  \quad и \quad G^{Q}\bmod P != 1 }\]</div>
</div></blockquote>
<p>Согласно малой теореме Ферма можно утверждать,что если для какого-то числа a &lt; P выполняется условие <span class="math notranslate nohighlight">\(a^{P-1} \bmod P != 1\)</span> ,  то число  является составным. Исходя из данного утверждения, можно легко разработать тест Ферма для проверки на простоту:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bool</span> <span class="n">testFerma</span><span class="p">(</span><span class="n">long</span> <span class="n">long</span> <span class="n">p</span><span class="p">,</span> <span class="nb">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
 <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
 <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span>  <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
 <span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">k</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">long</span> <span class="n">long</span> <span class="n">a</span><span class="o">=</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span> <span class="o">||</span> <span class="n">powMod</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span><span class="p">)</span>
     <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
 <span class="p">}</span>
 <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Абоненты выбирают большие числа Xa, Xb, Xc, которые храняться в секрете. Каждый абонент вычисляет соответсвующее число Y, которое открыто передается другим абонентам</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin {cases} {Y_A = g^{X_A} \bmod p} \\
   {Y_B = g^{X_B} \bmod p} \\
   {Y_C = g^{X_C} \bmod p} \\
  \end {cases}\end{split}\]</div>
<p>Допустим, абонент A решил организовать сеанс связи с B, при этом обоим абонентам доступна открытая информация (P, G, Y). Абонент A сообщает B по открытому каналу, что он хочет передать ему сообщение. Затем абонент A вычисляет величину:</p>
<div class="math notranslate nohighlight">
\[{Z_{AB} = (Y_B)^{X_A} \bmod p}\]</div>
<p>В свою очередь, абонент B вычисляет число:</p>
<div class="math notranslate nohighlight">
\[{Z_{BA} = (Y_A)^{X_B} \bmod p}\]</div>
<p>Получаем что:</p>
<div class="math notranslate nohighlight">
\[{Z_{BA} = Z_{AB} }\]</div>
<p>Доказательство:</p>
<div class="math notranslate nohighlight">
\[\begin{split}{Z_{AB} = (Y_B)^{X_A} \bmod p = (g^{X_B})^{X_A} \bmod p = \\
    = g^{X_A X_B} \bmod p = (Y_A)^{X_B} \bmod p = Z_{BA} }\end{split}\]</div>
<dl class="simple">
<dt>Пример:</dt><dd><p>Пусть P = 23 = 2 · 11 + 1 (Q = 11). Выберем параметр G. Попробуем взять g = 3. Проверим: 3^11 mod 23 = 1 и значит, такое g не подходит. Возьмем g = 5. Проверим: 5^11 mod 23 = 22. Итак, мы выбрали параметры p = 23, g = 5. Теперь каждый абонент выбирает секретное число и вычисляет соответствующее ему открытое число. Пусть выбраны Xa = 7 , Xb = 13 . Вычисляем Ya = 5^7 mod 23 = 17, Yb = 5^13 mod 23 = 21. Пусть A и B решили сформировать общий секретный ключ. Для этого A вычисляет Zab = 21^7 mod 23 = 10, а B вычисляет Zba = 17^13 mod 23 = 10.Теперь они имеют общий ключ 10, который не передавался по каналу связи</p>
</dd>
</dl>
<p>Листинг программы:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Diffie-Hellman.java</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">generateParameters</span><span class="p">(){</span>
        <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
        <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
        <span class="kt">long</span> <span class="n">Q</span><span class="p">;</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="n">MAX_VALUE</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
            <span class="n">P</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Q</span> <span class="o">+</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">isPrime</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">isPrime</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">testFerma</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="mi">100</span><span class="p">));</span>

        <span class="k">do</span> <span class="p">{</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span><span class="c1">// 1 &lt; q &lt; p -1</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">ModularExponentiation</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="n">P</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">);</span>

        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;P = &quot;</span><span class="o">+</span><span class="n">P</span><span class="o">+</span><span class="s">&quot; G = &quot;</span><span class="o">+</span><span class="n">G</span><span class="o">+</span><span class="s">&quot; Q = &quot;</span><span class="o">+</span><span class="n">Q</span><span class="p">);</span>
    <span class="p">}</span>
<span class="c1">// Abonent.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Abonent</span> <span class="p">{</span>
    <span class="n">DiffieHellman</span> <span class="n">diffieHellman</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">secretKey</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">publicKey</span><span class="p">;</span>

    <span class="kd">public</span> <span class="nf">Abonent</span><span class="p">(</span><span class="n">DiffieHellman</span> <span class="n">diffieHellman</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">diffieHellman</span> <span class="o">=</span> <span class="n">diffieHellman</span><span class="p">;</span>
        <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
        <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
        <span class="n">secretKey</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="n">diffieHellman</span><span class="p">.</span><span class="na">getP</span><span class="p">()</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">publicKey</span> <span class="o">=</span> <span class="n">ModularExponentiation</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">diffieHellman</span><span class="p">.</span><span class="na">getG</span><span class="p">(),</span><span class="n">secretKey</span><span class="p">,</span> <span class="n">diffieHellman</span><span class="p">.</span><span class="na">getP</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">calculateZ</span><span class="p">(</span><span class="kt">long</span> <span class="n">publicSecondAbonentKey</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">ModularExponentiation</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">publicSecondAbonentKey</span><span class="p">,</span> <span class="n">secretKey</span><span class="p">,</span> <span class="n">diffieHellman</span><span class="p">.</span><span class="na">getP</span><span class="p">());</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>Шифр Шамира<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h3>
<p>Этот шифр, предложенный Шамиром (Adi Shamir), был первым, позволяющим организовать обмен секретными сообщениями по открытой линии связи для лиц, которые не имеют никаких защищенных каналов и секретных ключей и, возможно, никогда не видели друг друга.</p>
<p>Пусть есть два абонента A и B, соединенные линией связи. A хочет передать сообщение m абоненту B так, чтобы никто не узнал его содержание. A выбирает случайное большое простое число P и открыто передает его B. Затем A выбирает два числа Ca и Da , такие, что</p>
<div class="math notranslate nohighlight">
\[\begin{split}{ C_A*D_A \bmod (P-1) = 1  \\
    C_B*D_B \bmod (P-1) = 1 }\end{split}\]</div>
<p>Вычисляем C и D, используя обобщенный алгоритм Эвклида</p>
<div class="math notranslate nohighlight">
\[\begin{split}Вычисляем \ y: \ ax + by = gcd(a, b) ,\ где \ C \ рандомное \ число \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}если \ gcd(С, P-1) \ = \ 1, \ то \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[D = y + (P - 1)\]</div>
<p>Листинг программы вычисляющей C и D:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Shamir</span> <span class="p">{</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">P</span><span class="p">;</span>
   <span class="kd">private</span> <span class="kt">long</span> <span class="n">C</span><span class="p">;</span>
   <span class="kd">private</span> <span class="kt">long</span> <span class="n">D</span><span class="p">;</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">generatePublicP</span><span class="p">()</span> <span class="p">{</span>
       <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
       <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
       <span class="kt">long</span> <span class="n">P</span><span class="p">;</span>
       <span class="k">do</span> <span class="p">{</span>
           <span class="n">P</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="n">MAX_VALUE</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
       <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">DiffieHellman</span><span class="p">.</span><span class="na">isPrime</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">DiffieHellman</span><span class="p">.</span><span class="na">testFerma</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="mi">100</span><span class="p">));</span>
       <span class="k">return</span> <span class="n">P</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="nf">Shamir</span><span class="p">(</span><span class="kt">long</span> <span class="n">P</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">this</span><span class="p">.</span><span class="na">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">;</span>
       <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
       <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
       <span class="kt">long</span><span class="o">[]</span> <span class="n">EuclidResult</span><span class="p">;</span>
       <span class="k">do</span> <span class="p">{</span>
           <span class="k">do</span> <span class="p">{</span>
               <span class="k">this</span><span class="p">.</span><span class="na">C</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="n">MAX_VALUE</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
               <span class="n">EuclidResult</span> <span class="o">=</span> <span class="n">Euclid</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
           <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">EuclidResult</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">);</span>
           <span class="k">this</span><span class="p">.</span><span class="na">D</span> <span class="o">=</span> <span class="n">EuclidResult</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
       <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">C</span><span class="o">*</span><span class="n">D</span><span class="o">%</span><span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">);</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>После этого A передает свое сообщение m. Если m &lt; P, то сообщение передается сразу, если же m &gt;= P, то сообщение разбивается на части. Рассмотрим случай m &lt; P
<strong>Шаг 1.</strong> A вычисляет число</p>
<div class="math notranslate nohighlight">
\[{x_1 = m^{C_A} \bmod p, }\]</div>
<p><strong>Шаг 2.</strong> B получив x1, вычисляет</p>
<div class="math notranslate nohighlight">
\[{x_2 = x_1^{C_B} \bmod p, }\]</div>
<p><strong>Шаг 3.</strong> A вычисляет число</p>
<div class="math notranslate nohighlight">
\[{x_3 = x_2^{D_A} \bmod p, }\]</div>
<p><strong>Шаг 4.</strong> B получив x3, вычисляет</p>
<div class="math notranslate nohighlight">
\[{x_4 = x_3^{D_B} \bmod p, }\]</div>
<p>Пример хода алгоритма:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="mi">23</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">6</span>
<span class="nl">A:</span>  <span class="n">Ca</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>  <span class="n">Da</span> <span class="o">=</span> <span class="mi">19</span>
<span class="nl">B:</span>   <span class="n">Cb</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span>  <span class="n">Db</span> <span class="o">=</span> <span class="mi">17</span>

<span class="n">x1</span><span class="p">,</span>  <span class="n">x2</span><span class="p">,</span>  <span class="n">x3</span><span class="p">,</span>  <span class="n">x4</span>  <span class="p">(</span><span class="o">==</span><span class="mi">6</span><span class="p">)</span>

<span class="mi">22</span> <span class="mi">0</span>  <span class="p">(</span><span class="n">выбрасываем</span> <span class="n">второй</span> <span class="n">столбец</span><span class="p">)</span>
<span class="mi">7</span>  <span class="mi">1</span>
<span class="o">----</span>
<span class="mi">1</span> <span class="o">-</span><span class="mi">3</span>   <span class="n">q</span> <span class="o">=</span> <span class="mi">22</span> <span class="o">/</span> <span class="mi">7</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">Da</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="o">+</span><span class="mi">22</span> <span class="o">=</span> <span class="mi">19</span>

<span class="mi">22</span> <span class="mi">0</span>
<span class="mi">13</span> <span class="mi">1</span>
<span class="o">----</span>
<span class="mi">9</span> <span class="o">-</span><span class="mi">1</span>       <span class="n">q</span> <span class="o">=</span> <span class="mi">22</span> <span class="o">/</span> <span class="mi">13</span> <span class="o">=</span> <span class="mi">1</span>
<span class="mi">4</span>  <span class="mi">2</span>       <span class="n">q</span> <span class="o">=</span> <span class="mi">13</span> <span class="o">/</span> <span class="mi">9</span> <span class="o">=</span> <span class="mi">1</span>
<span class="mi">1</span>  <span class="o">-</span><span class="mi">5</span>      <span class="n">q</span> <span class="o">=</span> <span class="mi">9</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">Db</span> <span class="o">=</span> <span class="mi">22</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">=</span> <span class="mi">17</span>

<span class="nl">A:</span> <span class="n">x1</span> <span class="o">=</span> <span class="mi">6</span><span class="o">^</span><span class="mi">7</span> <span class="n">mod</span> <span class="mi">23</span> <span class="o">=</span> <span class="mi">3</span>
<span class="nl">B:</span> <span class="n">x2</span> <span class="o">=</span> <span class="mi">3</span><span class="o">^</span><span class="mi">13</span> <span class="n">mod</span> <span class="mi">23</span> <span class="o">=</span> <span class="mi">9</span>
<span class="nl">A:</span> <span class="n">x3</span> <span class="o">=</span> <span class="mi">9</span><span class="o">^</span><span class="mi">19</span> <span class="n">mod</span> <span class="mi">23</span> <span class="o">=</span> <span class="mi">13</span>
<span class="nl">B:</span> <span class="n">x4</span> <span class="o">=</span> <span class="mi">13</span><span class="o">^</span><span class="mi">17</span> <span class="n">mod</span> <span class="mi">23</span> <span class="o">=</span> <span class="mi">6</span>
</pre></div>
</div>
<p>Листинг программы шифрования файлов:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Shamir.java</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="nf">ShamirCalcIteration</span><span class="p">(</span><span class="n">String</span> <span class="n">path</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">prevX</span><span class="p">,</span> <span class="kt">int</span> <span class="n">numOfIteration</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
       <span class="k">switch</span> <span class="p">(</span><span class="n">numOfIteration</span><span class="p">)</span> <span class="p">{</span>
           <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
               <span class="kt">byte</span><span class="o">[]</span> <span class="n">byteArray</span> <span class="o">=</span> <span class="n">getFileBytes</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
               <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">x1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

               <span class="k">for</span> <span class="p">(</span><span class="kt">byte</span> <span class="n">a</span> <span class="p">:</span> <span class="n">byteArray</span><span class="p">)</span> <span class="p">{</span>
                   <span class="n">x1</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">getC</span><span class="p">(),</span> <span class="n">P</span><span class="p">));</span>
               <span class="p">}</span>
               <span class="k">return</span> <span class="n">x1</span><span class="p">;</span>
           <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
               <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">x2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
               <span class="k">for</span> <span class="p">(</span><span class="n">Long</span> <span class="n">a</span> <span class="p">:</span> <span class="n">prevX</span><span class="p">)</span> <span class="p">{</span>
                   <span class="n">x2</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">getC</span><span class="p">(),</span> <span class="n">P</span><span class="p">));</span>
               <span class="p">}</span>
               <span class="k">return</span> <span class="n">x2</span><span class="p">;</span>
           <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
               <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">x3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
               <span class="k">for</span> <span class="p">(</span><span class="n">Long</span> <span class="n">a</span> <span class="p">:</span> <span class="n">prevX</span><span class="p">)</span> <span class="p">{</span>
                   <span class="n">x3</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">getD</span><span class="p">(),</span> <span class="n">P</span><span class="p">));</span>
               <span class="p">}</span>
               <span class="k">return</span> <span class="n">x3</span><span class="p">;</span>
           <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
               <span class="kt">byte</span><span class="o">[]</span> <span class="n">outFile</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">prevX</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="o">]</span><span class="p">;</span>
               <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">prevX</span><span class="p">.</span><span class="na">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                   <span class="n">outFile</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">prevX</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">getD</span><span class="p">(),</span> <span class="n">P</span><span class="p">);</span>
               <span class="p">}</span>
               <span class="n">getFileFromBytes</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">outFile</span><span class="p">);</span>
               <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
       <span class="p">}</span>
       <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
   <span class="p">}</span>
 <span class="c1">// Main.java</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
       <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;&lt;Shamir&gt;&quot;</span><span class="p">);</span>
       <span class="kt">long</span> <span class="n">P</span> <span class="o">=</span> <span class="n">Shamir</span><span class="p">.</span><span class="na">generatePublicP</span><span class="p">();</span>

       <span class="n">Shamir</span> <span class="n">A</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Shamir</span><span class="p">(</span><span class="n">P</span><span class="p">);</span>
       <span class="n">FileManipulation</span><span class="p">.</span><span class="na">KeysToFile</span><span class="p">(</span><span class="s">&quot;Shamir&quot;</span><span class="p">,</span><span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="na">getC</span><span class="p">(),</span> <span class="n">A</span><span class="p">.</span><span class="na">getD</span><span class="p">());</span>

       <span class="n">Shamir</span> <span class="n">B</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Shamir</span><span class="p">(</span><span class="n">P</span><span class="p">);</span>
       <span class="n">FileManipulation</span><span class="p">.</span><span class="na">KeysToFile</span><span class="p">(</span><span class="s">&quot;Shamir&quot;</span><span class="p">,</span><span class="s">&quot;B&quot;</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="na">getC</span><span class="p">(),</span> <span class="n">B</span><span class="p">.</span><span class="na">getD</span><span class="p">());</span>

       <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="na">ShamirCalcIteration</span><span class="p">(</span><span class="s">&quot;files/pic.jpg&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
       <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="na">ShamirCalcIteration</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
       <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">x3</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="na">ShamirCalcIteration</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
       <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">x4</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="na">ShamirCalcIteration</span><span class="p">(</span><span class="s">&quot;files/picShamir.jpg&quot;</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
 <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3>Шифр Эль Гамаля<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h3>
<p>Пусть имеются абоненты A , B , C , … , которые хотят передавать друг другу зашифрованные сообщения, не имея никаких защищенных каналов связи. В этом разделе мы рассмотрим шифр, предложенный Эль-Гамалем (Taher ElGamal), который решает эту задачу, используя, в отличие от шифра Шамира, только одну пересылку сообщения. Фактически здесь используется схема Диффи–Хеллмана, чтобы сформировать общий секретный ключ для двух абонентов, передающих друг другу сообщение, и затем сообщение шифруется путем умножения его на этот ключ. Для каждого следующего сообщения секретный ключ вычисляется заново.</p>
<p>Для всей группы абонентов выбираются числа <em>P</em> и <em>G</em> подобно как мы это делали в шифре Диффи-Хэллмана:</p>
<div class="math notranslate nohighlight">
\[P - простое, \ 1 \ &lt; \ G \ &lt; \ (P-1), \ m &lt; P\]</div>
<p>Затем каждый абонент группы выбирает свое секретное число <span class="math notranslate nohighlight">\(С, \ 1 &lt; C &lt; P-1\)</span>, и вычисляет соответсвующее ему открытое число <span class="math notranslate nohighlight">\(D\)</span>:</p>
<div class="math notranslate nohighlight">
\[D = G^{C} \bmod P\]</div>
<p>Ход алгоритма:</p>
<p><strong>Шаг.1:</strong> A формирует случайное число <span class="math notranslate nohighlight">\(k, \ 1 &lt;= k &lt;= P - 2\ \)</span> и вычисляет числа:</p>
<div class="math notranslate nohighlight">
\[\begin{split}r = G^{k} \bmod p, \\
e = m * D_B^{k} \bmod p\end{split}\]</div>
<p>и передает пару числое (r, e) абоненту B</p>
<p><strong>Шаг.2</strong> B, получив (r, e), вычисляет</p>
<div class="math notranslate nohighlight">
\[m' = e * r^{P-1-C_B} \bmod p = m\]</div>
<p>Доказательство:</p>
<div class="math notranslate nohighlight">
\[\begin{split}Подставим \ e \ в \ m' ,\ (e = m * D_B \bmod p) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}=&gt;  \ m' = m * D_B * r^{P-1-C_B} \bmod p, \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}Подставим \ r \ и \ D_B \ в \ m' , \ (r = G^{k} \bmod p), \ (D_B = G^{C} \bmod P) \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}=&gt;  m' = m * (G^{C_B})^{k} * (G^{k})^{P - 1 - C_B} \bmod p =  m * G^{C_Bk + k(P-1 -kC_B)} \bmod p = m * G^{k(P-1)} \bmod p \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}По \ теореме \ Ферма: G^{k(P-1)} \bmod p = 1^{k} \bmod p = 1 \\\\\end{split}\]</div>
<p>Листинг программы шифрования файлов:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// ElGamal.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ElGamal</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">P</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">G</span><span class="p">;</span>

  <span class="kd">private</span> <span class="kt">long</span> <span class="n">C</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">long</span> <span class="n">D</span><span class="p">;</span>

  <span class="kd">private</span> <span class="kt">long</span> <span class="n">R</span><span class="p">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">generateParameters</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">DiffieHellman</span> <span class="n">diffieHellman</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiffieHellman</span><span class="p">();</span>
      <span class="n">diffieHellman</span><span class="p">.</span><span class="na">generateParameters</span><span class="p">();</span>
      <span class="n">setP</span><span class="p">(</span><span class="n">diffieHellman</span><span class="p">.</span><span class="na">getP</span><span class="p">());</span>
      <span class="n">setG</span><span class="p">(</span><span class="n">diffieHellman</span><span class="p">.</span><span class="na">getG</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="nf">ElGamal</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
      <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
      <span class="n">C</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">P</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">D</span> <span class="o">=</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">P</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="nf">elGamalSendMessage</span><span class="p">(</span><span class="kt">long</span> <span class="n">D</span><span class="p">,</span> <span class="n">String</span> <span class="n">path</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
      <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
      <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
      <span class="kt">long</span> <span class="n">k</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">P</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="kt">byte</span><span class="o">[]</span> <span class="n">byteArray</span> <span class="o">=</span> <span class="n">getFileBytes</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
      <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">E</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

      <span class="kt">long</span> <span class="n">partD</span> <span class="o">=</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">P</span><span class="p">);</span>

      <span class="k">for</span> <span class="p">(</span><span class="kt">byte</span> <span class="n">b</span> <span class="p">:</span> <span class="n">byteArray</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">E</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">partD</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">P</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="n">R</span> <span class="o">=</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">P</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">E</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">elGamalReceiveMessage</span> <span class="p">(</span><span class="kt">long</span> <span class="n">R</span><span class="p">,</span> <span class="n">List</span> <span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">E</span><span class="p">,</span> <span class="n">String</span> <span class="n">Out</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
      <span class="kt">byte</span> <span class="o">[]</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">E</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="o">]</span><span class="p">;</span>
      <span class="kt">long</span> <span class="n">partR</span> <span class="o">=</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">C</span><span class="p">,</span> <span class="n">P</span><span class="p">);</span>

      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">E</span><span class="p">.</span><span class="na">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">result</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">E</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">partR</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">P</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">getFileFromBytes</span><span class="p">(</span><span class="n">Out</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getC</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">C</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getD</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">D</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getR</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">R</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setP</span><span class="p">(</span><span class="kt">int</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">P</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setG</span><span class="p">(</span><span class="kt">int</span> <span class="n">g</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">G</span> <span class="o">=</span> <span class="n">g</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Main.java</span>

 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="p">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
      <span class="n">ElGamal</span><span class="p">.</span><span class="na">generateParameters</span><span class="p">();</span>

      <span class="n">ElGamal</span> <span class="n">N</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ElGamal</span><span class="p">();</span>
      <span class="n">FileManipulation</span><span class="p">.</span><span class="na">KeysToFile</span><span class="p">(</span><span class="s">&quot;ElGamal&quot;</span><span class="p">,</span> <span class="s">&quot;N&quot;</span><span class="p">,</span> <span class="n">N</span><span class="p">.</span><span class="na">getC</span><span class="p">(),</span> <span class="n">N</span><span class="p">.</span><span class="na">getD</span><span class="p">());</span>

      <span class="n">ElGamal</span> <span class="n">M</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ElGamal</span><span class="p">();</span>
      <span class="n">FileManipulation</span><span class="p">.</span><span class="na">KeysToFile</span><span class="p">(</span><span class="s">&quot;ElGamal&quot;</span><span class="p">,</span> <span class="s">&quot;M&quot;</span><span class="p">,</span> <span class="n">M</span><span class="p">.</span><span class="na">getC</span><span class="p">(),</span> <span class="n">M</span><span class="p">.</span><span class="na">getD</span><span class="p">());</span>

      <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">E</span> <span class="o">=</span>  <span class="n">N</span><span class="p">.</span><span class="na">elGamalSendMessage</span><span class="p">(</span><span class="n">M</span><span class="p">.</span><span class="na">getD</span><span class="p">(),</span> <span class="s">&quot;files/pic.jpg&quot;</span><span class="p">);</span>
      <span class="n">M</span><span class="p">.</span><span class="na">elGamalReceiveMessage</span><span class="p">(</span><span class="n">N</span><span class="p">.</span><span class="na">getR</span><span class="p">(),</span> <span class="n">E</span><span class="p">,</span> <span class="s">&quot;files/picElgamal.jpg&quot;</span><span class="p">);</span>

      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;ElGamal successful complete&quot;</span><span class="p">);</span>

   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="rsa">
<h3>Шифр RSA<a class="headerlink" href="#rsa" title="Ссылка на этот заголовок">¶</a></h3>
<p>Мы видели, что шифр Шамира полностью решает задачу обмена сообщениями, закрытыми для прочтения, в случае, когда абоненты могут пользоваться только открытыми линиями связи. Однако при этом сообщение пересылается три раза от одного абонента к другому, что является недостатком. Шифр Эль-Гамаля позволяет решить ту же задачу за одну пересылку данных, но объем передаваемого шифротекста в два раза превышает объем сообщения. Система RSA лишена подобных недостатков. Интересно то, что она базируется на другой односторонней функции, отличной от дискретного логарифма. Кроме того, здесь мы встретимся с еще одним изобретением современной криптографии – односторонней функцией с «лазейкой» (trapdoor function)</p>
<p>Эта система базируется на следующих двух фактах из теории
чисел:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Задача проверки числа на простоту является сравнительно легкой</p></li>
<li><p>Задача разложения чисел вида <span class="math notranslate nohighlight">\(n = pq\)</span> (p и q — простые числа) на множители является очень трудной, если мы знаем только n, а p и q — большие числа (это так называемая задача факторизации)</p></li>
</ol>
</div></blockquote>
<p>В нашей системе есть абоненты A, B. Каждый абонент выбирает случайное два больших простых числа <em>P</em> и <em>Q</em>. Затем он вычисляет число открытое для всех пользователей системы</p>
<div class="math notranslate nohighlight">
\[N = P*Q\]</div>
<p>После этого абонент вычисляет число</p>
<div class="math notranslate nohighlight">
\[\phi = (P-1)(Q-1)\]</div>
<p>И выбирает некоторое число <span class="math notranslate nohighlight">\(D &lt; \phi\)</span>, взаимно простое с <span class="math notranslate nohighlight">\(\phi\)</span>, и по обобщенному алгоритму Эвклида находит число С, такое что</p>
<div class="math notranslate nohighlight">
\[C*D \bmod \phi = 1\]</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/keys_rsa.png"><img alt="keys_rsa" src="../../_images/keys_rsa.png" style="width: 500px;" /></a>
</div>
<p>Ход алгоритма:</p>
<p><strong>Шаг 1.</strong> А шифрует сообщение по формуле</p>
<div class="math notranslate nohighlight">
\[e = m^{D_B} \bmod N_B\]</div>
<p><strong>Шаг 2.</strong> B получивший e, вычисляет</p>
<div class="math notranslate nohighlight">
\[m^{'} = e^{C_B} \bmod N_B = m\]</div>
<p>Доказательство:</p>
<div class="math notranslate nohighlight">
\[m^{'} = e^{C_B} \bmod N_B = m^{D_B*C_B} \bmod N_B\]</div>
<div class="math notranslate nohighlight">
\[\ для \ некоторого \ k:\]</div>
<div class="math notranslate nohighlight">
\[C_B*D_B = k \phi_B + 1\]</div>
<div class="math notranslate nohighlight">
\[\phi_B = (P_B - 1)(Q_B - 1) = \varphi (N_B),\]</div>
<div class="math notranslate nohighlight">
\[\ где \ \varphi() - \ Функция \ Эйлера\]</div>
<div class="math notranslate nohighlight">
\[m^{'} = m^{k* \phi(N_B)+1} \bmod N_B = m\]</div>
<p>Пример:</p>
<div class="math notranslate nohighlight">
\[m = 15, \ P_B = 3, \ Q_B = 1, \ N_B = 33, \ D_B = 3\]</div>
<div class="math notranslate nohighlight">
\[3 \ взаимно \ простое \ с \ \phi(33) = 20 \ ((P-1)(Q-1) = 20 )\]</div>
<div class="math notranslate nohighlight">
\[Найдем \ C_B \ c \ помощью \ обощенного \ алгоритма \ Эвклида:\]</div>
<div class="math notranslate nohighlight">
\[C_B = 7 \ Проверка: \ 3*7 \bmod 20 = 1\]</div>
<div class="math notranslate nohighlight">
\[e = 15^{3} \bmod 33 = 15^{2} * 15 \bmod 33 = 27*15 \bmod 33 = 9\]</div>
<div class="math notranslate nohighlight">
\[m^{'} = 9^{7} \bmod 33 = (9^{2})^{2} * 9^{2} * 9 \bmod 33 = 15^{2} * 15 * 9 \bmod 33 = 15 = m\]</div>
<p>Листинг программы:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RSA</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">MAX_VALUE</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">long</span> <span class="n">P</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">long</span> <span class="n">Q</span><span class="p">;</span>

  <span class="kd">private</span> <span class="kt">long</span> <span class="n">N</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">long</span> <span class="n">phi</span><span class="p">;</span>

  <span class="kd">private</span> <span class="kt">long</span> <span class="n">C</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">long</span> <span class="n">D</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">RSA</span> <span class="p">()</span> <span class="p">{</span>
      <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
      <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
      <span class="k">do</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="na">P</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="n">MAX_VALUE</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">isPrime</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">testFerma</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="mi">100</span><span class="p">));</span>

      <span class="k">do</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="na">Q</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="n">MAX_VALUE</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">isPrime</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">testFerma</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="mi">100</span><span class="p">));</span>

      <span class="k">this</span><span class="p">.</span><span class="na">N</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">Q</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="na">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Q</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="kt">long</span><span class="o">[]</span> <span class="n">EuclidResult</span><span class="p">;</span>
      <span class="k">do</span> <span class="p">{</span>
          <span class="k">do</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="na">D</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">phi</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
              <span class="n">EuclidResult</span> <span class="o">=</span>  <span class="n">Euclid</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">phi</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">EuclidResult</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">);</span>
          <span class="k">this</span><span class="p">.</span><span class="na">C</span> <span class="o">=</span> <span class="n">EuclidResult</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">+</span> <span class="n">phi</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">C</span><span class="o">%</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="nf">sendMessage</span><span class="p">(</span><span class="n">String</span> <span class="n">path</span><span class="p">,</span> <span class="kt">long</span> <span class="n">D</span><span class="p">,</span> <span class="kt">long</span> <span class="n">N</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
      <span class="kt">byte</span><span class="o">[]</span> <span class="n">byteArray</span> <span class="o">=</span> <span class="n">getFileBytes</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>

      <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">E</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

      <span class="k">for</span> <span class="p">(</span><span class="kt">byte</span> <span class="n">b</span> <span class="p">:</span> <span class="n">byteArray</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">E</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">E</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">receiveMessage</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">E</span><span class="p">,</span> <span class="n">String</span> <span class="n">path</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
      <span class="kt">byte</span> <span class="o">[]</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">E</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="o">]</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">E</span><span class="p">.</span><span class="na">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">result</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">E</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">getC</span><span class="p">(),</span> <span class="n">getN</span><span class="p">());</span>
      <span class="p">}</span>
      <span class="n">getFileFromBytes</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getP</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">P</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getQ</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">Q</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getN</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">N</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getC</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">C</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getD</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">D</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getPhi</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">phi</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h3>Шифр Вернама<a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h3>
<p>Этот шифр был предложен в 1926 году американским инженером Вернамом (Gilbert Vernam) и использовался на практике, но доказательство его невскрываемости было получено значительно позже Шенноном. Простейший шифр на основе бинарной логики (а именно операции XOR), который обладает абсолютной криптографической стойкостью. Без знания ключа, расшифровать его невозможно Для шифра Вернама часто используется название «одноразовая лента» (one-time pad). Мы опишем этот шифр для случая двоичного алфавита, чтобы упростить обозначения. Пусть множество сообщений M состоит из слов двоичного алфавита длины n , т.е. всего сообщений не более, чем 2 n.</p>
<table class="docutils align-default" id="id26">
<caption><span class="caption-text">Таблица истинности XOR</span><a class="headerlink" href="#id26" title="Постоянная ссылка на таблицу">¶</a></caption>
<colgroup>
<col style="width: 24%" />
<col style="width: 29%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>a</p></th>
<th class="head"><p>b</p></th>
<th class="head"><p>a XOR b</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
<p>В шифре Вернама множество ключей также состоит из слов той же длины n и каждый ключ используется с вероятностью 1/2 n . Другими словами, все ключи используются с одинаковой вероятностью. Пусть необходимо зашифровать сообщение <span class="math notranslate nohighlight">\(m̄ = m_1,m_2 . . . m_n\)</span> и пусть выбран ключ <span class="math notranslate nohighlight">\(k̄ = k_1, k_2 . . . k_n\)</span>. Тогда зашифрованное сообщение <span class="math notranslate nohighlight">\(ē = e_1,e_2 . . . e_n\)</span> получается по формуле:</p>
<div class="math notranslate nohighlight">
\[e_i = m_i \oplus k_i\]</div>
<p>Дешифрование осуществляется по формуле:</p>
<div class="math notranslate nohighlight">
\[m_i = e_i \oplus k_i\]</div>
<p>Листинг программы шифрования файлов:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Vernam</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">secretKey</span><span class="p">;</span>

  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encryptFile</span><span class="p">(</span><span class="n">String</span> <span class="n">path</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
      <span class="kt">byte</span><span class="o">[]</span> <span class="n">byteArray</span> <span class="o">=</span> <span class="n">getFileBytes</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
      <span class="n">secretKey</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">byteArray</span><span class="p">.</span><span class="na">length</span><span class="o">]</span><span class="p">;</span>
      <span class="kt">byte</span><span class="o">[]</span> <span class="n">encryptMessage</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">byteArray</span><span class="p">.</span><span class="na">length</span><span class="o">]</span><span class="p">;</span>
      <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
      <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">byteArray</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">secretKey</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="n">Byte</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">);</span>
          <span class="n">encryptMessage</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="n">byteArray</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">^</span> <span class="n">secretKey</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">encryptMessage</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">decryptFile</span><span class="p">(</span><span class="n">String</span> <span class="n">path</span><span class="p">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">encryptMessage</span><span class="p">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">key</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
      <span class="kt">byte</span><span class="o">[]</span> <span class="n">decryptMessage</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">encryptMessage</span><span class="p">.</span><span class="na">length</span><span class="o">]</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">encryptMessage</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">decryptMessage</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="n">encryptMessage</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">^</span> <span class="n">key</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">getFileFromBytes</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">decryptMessage</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getSecretKey</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">secretKey</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id10">
<h2>Глава 2. Методы взлома шифров, основанных на дискретном логарифмировании<a class="headerlink" href="#id10" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="id11">
<h3>Метод «шаг младенца, шаг великана»<a class="headerlink" href="#id11" title="Ссылка на этот заголовок">¶</a></h3>
<p>Это был один из первых методов, который показал, что задача вычисления дискретного логарифма может быть решена значительно быстрее, чем методом перебора. Перейдем к описанию этого метода отыскания x</p>
<p>Задача поиска x, при известных a и y. Сначала берем два целых числа m и k, такие что</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[{ m * k &gt; p, \quad m = k = \sqrt{p} + 1 }\]</div>
</div></blockquote>
<p>Вычислим два ряда чисел:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\begin{split}y,ay,a^{2y},...a^{m-1}y \quad (\bmod p) \\
  a^{m},a^{2m},...a^{km} \quad (\bmod p)\end{split}\]</div>
<p>(все вычисления по модулю p)</p>
</div></blockquote>
<p>Найдем такие i и j, для которых выполняется равенство</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[{ a^{im} = a^{i} * y }\]</div>
</div></blockquote>
<p>Число x:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[{ x = i * m - j }\]</div>
</div></blockquote>
<p>Листинг программы:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BabyGiantSteps</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">calculate</span><span class="p">(</span><span class="kt">long</span> <span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">p</span><span class="p">,</span> <span class="kt">long</span> <span class="n">y</span><span class="p">)</span>  <span class="p">{</span>
        <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
        <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">ji</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>
        <span class="n">ji</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">ji</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="kt">long</span> <span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="na">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="c1">// sqrt(p)+1</span>
            <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="na">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;;</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">);</span>
<span class="c1">//        System.out.println(&quot;m = &quot;+m+&quot; k = &quot;+k);</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Long</span><span class="p">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">rowY</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="c1">// y, ay, a^2y...</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rowY</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(((</span><span class="kt">long</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="na">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">rowY</span><span class="p">.</span><span class="na">put</span><span class="p">(((</span><span class="kt">long</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="na">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">// a^m, a^2m ...</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">rowY</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(((</span><span class="kt">long</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="na">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">m</span><span class="p">))</span> <span class="o">%</span> <span class="n">p</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">ji</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">rowY</span><span class="p">.</span><span class="na">get</span><span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="na">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">m</span><span class="p">)</span><span class="o">%</span><span class="n">p</span><span class="p">);</span>
                <span class="n">ji</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ji</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ji</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">//  no solutions</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ji</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">*</span> <span class="n">m</span> <span class="o">-</span> <span class="n">ji</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id12">
<h2>Глава 3. Электронная, или цифровая подпись<a class="headerlink" href="#id12" title="Ссылка на этот заголовок">¶</a></h2>
<p>Прежде чем начать рассмотрение криптографической цифровой подписи, сформулируем три свойства, которым
(в идеале) должна удовлетворять любая, в частности, обычная рукописная подпись:</p>
<blockquote>
<div><ul class="simple">
<li><p>Подписать документ может только «законный» владелец подписи (и, следовательно, никто не может подделать подпись)</p></li>
<li><p>Автор подписи не может от нее отказаться</p></li>
<li><p>В случае возникновения спора возможно участие третьих лиц (например, суда) для установления подлинности подписи</p></li>
</ul>
</div></blockquote>
<div class="section" id="id13">
<h3>Электронная подпись RSA<a class="headerlink" href="#id13" title="Ссылка на этот заголовок">¶</a></h3>
<p>Если Абонент А планирует подписывать документы, то он должен вначале выбрать параметры RSA:</p>
<div class="math notranslate nohighlight">
\[P, \ Q \  - \ два \ больших \ простых \ числа\]</div>
<p>Далее вычислить:</p>
<div class="math notranslate nohighlight">
\[N = P * Q \ \ и \ \ \phi = (P − 1)(Q − 1)\]</div>
<p>Выбирает некоторое число <span class="math notranslate nohighlight">\(D &lt; \phi\)</span>, взаимно простое с <span class="math notranslate nohighlight">\(\phi\)</span>, и по обобщенному алгоритму Эвклида находит число С, такое что</p>
<div class="math notranslate nohighlight">
\[C*D \bmod \phi = 1\]</div>
<p>Далее эти параметры например, абонент помещает их на своем сайте, ассоциировав со своим именем, и хранит в секрете число С
(остальные числа P , Q и φ можно забыть, они больше не потребуются). Теперь А готов ставить свои подписи на документах или сообщениях</p>
<p>Пусть абонент А хочет подписать сообщение <span class="math notranslate nohighlight">\(m̄ = m 1 , . . . , m_n\)</span>. Тогда вначале она вычисляет хеш-функцию:</p>
<div class="math notranslate nohighlight">
\[y = h(m_1 , . . . , m_n )\]</div>
<p><strong>Практически невозможно изменить основной текст</strong> <span class="math notranslate nohighlight">\(m̄ = m 1 , . . . , m_n\)</span> , не изменив y. Поэтому на следующем шаге Алисе достаточно снабдить
подписью только число y , и эта подпись будет относиться ко всему сообщению m̄</p>
<p>Абонент А вычисляет число:</p>
<div class="math notranslate nohighlight">
\[s = y^{C_A} \bmod N_A\]</div>
<p>Число s это и есть цифровая подпись. Она просто добавляется к сообщению m̄, и тем самым Абонент А имеет сформированное подписанное сообщение:</p>
<div class="math notranslate nohighlight">
\[&lt; m̄ , s &gt;\]</div>
<p>Теперь каждый, кто знает открытые параметры А, ассоциированные с его именем, т.е. числа N и d , может проверить подлинность его подписи. Для этого необходимо, взяв подписанное сообщени, вычислить значение хеш-функции h( m̄), число:</p>
<div class="math notranslate nohighlight">
\[w = s^{D_A} \bmod N_A\]</div>
<p>Если подпись подлинна, то <span class="math notranslate nohighlight">\(w = s^{D_A} \bmod N_A = h(m̄)\)</span></p>
<p>Доказательство:</p>
<div class="math notranslate nohighlight">
\[w = s^{D} \bmod N = y^{CD} \bmod N = y = h(m̄)\]</div>
<p>Листинг программы:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">RSAsign</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">C</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">D</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">N</span><span class="p">;</span>

    <span class="kd">public</span> <span class="nf">RSAsign</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">RSA</span> <span class="n">rsa</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RSA</span><span class="p">();</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">.</span><span class="na">getC</span><span class="p">();</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">.</span><span class="na">getD</span><span class="p">();</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">.</span><span class="na">getN</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">signFileMD5</span><span class="p">(</span><span class="n">String</span> <span class="n">pathFile</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">NoSuchAlgorithmException</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">checksumMD5</span> <span class="o">=</span> <span class="n">DigestUtils</span><span class="p">.</span><span class="na">md5Hex</span><span class="p">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">pathFile</span><span class="p">));</span>
        <span class="n">BigInteger</span> <span class="n">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">checksumMD5</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="n">hash</span> <span class="o">=</span> <span class="n">hash</span><span class="p">.</span><span class="na">mod</span><span class="p">(</span><span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">N</span><span class="p">)));</span>

        <span class="kt">long</span> <span class="n">S</span> <span class="o">=</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">hash</span><span class="p">.</span><span class="na">longValue</span><span class="p">(),</span> <span class="n">C</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
        <span class="n">writeIntSignToFile</span><span class="p">(</span><span class="s">&quot;RSA&quot;</span><span class="p">,(</span><span class="kt">int</span><span class="p">)</span><span class="n">S</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">S</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkSign</span><span class="p">(</span><span class="n">String</span> <span class="n">pathFile</span><span class="p">,</span> <span class="kt">long</span> <span class="n">S</span><span class="p">,</span> <span class="kt">long</span> <span class="n">D</span><span class="p">,</span> <span class="kt">long</span> <span class="n">N</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">SignatureException</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">checksumMD5</span> <span class="o">=</span> <span class="n">DigestUtils</span><span class="p">.</span><span class="na">md5Hex</span><span class="p">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">pathFile</span><span class="p">));</span>
        <span class="n">BigInteger</span> <span class="n">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">checksumMD5</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="n">hash</span> <span class="o">=</span> <span class="n">hash</span><span class="p">.</span><span class="na">mod</span><span class="p">(</span><span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">N</span><span class="p">)));</span>

        <span class="kt">long</span> <span class="n">w</span> <span class="o">=</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>

        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;message = &quot;</span><span class="o">+</span><span class="n">hash</span><span class="o">+</span><span class="s">&quot; check = &quot;</span><span class="o">+</span><span class="n">w</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">!=</span> <span class="n">hash</span><span class="p">.</span><span class="na">longValue</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">SignatureException</span><span class="p">(</span><span class="s">&quot;digital signature RSA is invalid&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getD</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">D</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getN</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">N</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id14">
<h3>Электронная подпись на базе шифра Эль-Гамаля<a class="headerlink" href="#id14" title="Ссылка на этот заголовок">¶</a></h3>
<p>Пусть, как и выше, Алиса собирается подписывать документы. Алиса выбирает большое простое число P и число G , такие, что различные степени G суть различные числа по модулю P (см. Диффи-Хэлмана). Эти числа передаются или хранятся в открытом виде и могут быть общими для целой группы пользователей. Алиса выбирает <strong>секретный ключ X</strong>, <span class="math notranslate nohighlight">\(1 &lt; X &lt; p − 1\)</span> . Затем она вычисляет <strong>открытый ключ Y:</strong></p>
<div class="math notranslate nohighlight">
\[Y = G^{X} \bmod p\]</div>
<p>Теперь Алиса может подписывать сообщения. Вначале Алиса вычисляет значение хэш-функции <span class="math notranslate nohighlight">\(h = h(m̄)\)</span>, которое должно удовлетворять равенству <span class="math notranslate nohighlight">\(1 &lt; h &lt; p\)</span>. Затем Алиса выбирает случайно число <span class="math notranslate nohighlight">\(k \ ( 1 &lt; k &lt; p−1 )\)</span> , взаимно простое с <span class="math notranslate nohighlight">\(p−1\)</span>, и вычисляет число</p>
<div class="math notranslate nohighlight">
\[r = G^{k} \bmod p\]</div>
<p>Далее Алиса вычисляет число</p>
<div class="math notranslate nohighlight">
\[\begin{split}u = (h -Xr) \bmod (p-1) \\
s = k^{-1} u \bmod (p-1)\end{split}\]</div>
<p>Под <span class="math notranslate nohighlight">\(k^{-1}\)</span> подразумевается число, такое что</p>
<div class="math notranslate nohighlight">
\[k^{-1}*k \bmod (p-1) = 1\]</div>
<p>Такое <span class="math notranslate nohighlight">\(k^{-1}\)</span> существует, так как k и <span class="math notranslate nohighlight">\(p − 1\)</span> взаимно просты, и может быть найдено по обобщенному алгоритму Евклида. Наконец, Алиса формирует подписанное сообщение</p>
<div class="math notranslate nohighlight">
\[&lt;m̄; r, s&gt;\]</div>
<p>Получатель подписанного сообщения , прежде всего, заново вычисляет значение хеш-функции <span class="math notranslate nohighlight">\(h = h(m̄)\)</span>. Затем он проверяет подпись, используя равенство</p>
<div class="math notranslate nohighlight">
\[Y^{r}r^{s} \bmod p = G^{h} \bmod p\]</div>
<p>Листинг программы:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ElGamalSign</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">P</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">G</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kt">long</span> <span class="n">X</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">Y</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">r</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">BigInteger</span> <span class="n">S</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">generateParameters</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">DiffieHellman</span> <span class="n">diffieHellman</span> <span class="o">=</span>  <span class="k">new</span> <span class="n">DiffieHellman</span><span class="p">();</span>
        <span class="n">diffieHellman</span><span class="p">.</span><span class="na">generateParameters</span><span class="p">();</span>
        <span class="n">setP</span><span class="p">(</span><span class="n">diffieHellman</span><span class="p">.</span><span class="na">getP</span><span class="p">());</span>
        <span class="n">setG</span><span class="p">(</span><span class="n">diffieHellman</span><span class="p">.</span><span class="na">getG</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">ElGamalSign</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
        <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">P</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">P</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">signFile</span><span class="p">(</span><span class="n">String</span> <span class="n">pathFile</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="kt">long</span> <span class="n">k</span><span class="p">,</span> <span class="n">k_1</span><span class="p">;</span>
        <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
        <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>

        <span class="n">String</span> <span class="n">checksumMD5</span> <span class="o">=</span> <span class="n">DigestUtils</span><span class="p">.</span><span class="na">md5Hex</span><span class="p">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">pathFile</span><span class="p">));</span>
        <span class="n">BigInteger</span> <span class="n">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">checksumMD5</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="n">hash</span> <span class="o">=</span> <span class="n">hash</span><span class="p">.</span><span class="na">mod</span><span class="p">(</span><span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">P</span><span class="p">)));</span>

        <span class="kt">long</span><span class="o">[]</span> <span class="n">EuclidResult</span><span class="p">;</span>
        <span class="k">do</span> <span class="p">{</span>
             <span class="k">do</span> <span class="p">{</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">P</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
               <span class="n">EuclidResult</span> <span class="o">=</span>  <span class="n">Euclid</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
             <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">EuclidResult</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">k_1</span> <span class="o">=</span> <span class="n">EuclidResult</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">k_1</span><span class="o">%</span><span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">);</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">P</span><span class="p">);</span>
        <span class="n">BigInteger</span> <span class="n">u</span> <span class="o">=</span> <span class="n">hash</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">X</span><span class="o">*</span><span class="n">r</span><span class="p">)).</span><span class="na">mod</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">u</span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">k_1</span><span class="p">)).</span><span class="na">mod</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">writeIntSignToFile</span><span class="p">(</span><span class="s">&quot;ElGamal&quot;</span><span class="p">,</span><span class="n">S</span><span class="p">.</span><span class="na">intValue</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkSign</span><span class="p">(</span><span class="n">String</span> <span class="n">pathFile</span><span class="p">,</span> <span class="kt">long</span> <span class="n">Y_open</span><span class="p">,</span> <span class="kt">long</span> <span class="n">r_open</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">S</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">SignatureException</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">checksumMD5</span> <span class="o">=</span> <span class="n">DigestUtils</span><span class="p">.</span><span class="na">md5Hex</span><span class="p">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">pathFile</span><span class="p">));</span>
        <span class="n">BigInteger</span> <span class="n">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">checksumMD5</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="n">hash</span> <span class="o">=</span> <span class="n">hash</span><span class="p">.</span><span class="na">mod</span><span class="p">(</span><span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">P</span><span class="p">)));</span>

        <span class="n">BigInteger</span> <span class="n">Y_R</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">Y_open</span><span class="p">)));</span>
        <span class="n">Y_R</span> <span class="o">=</span> <span class="n">Y_R</span><span class="p">.</span><span class="na">modPow</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span> <span class="n">r_open</span><span class="p">),</span> <span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">P</span><span class="p">));</span>

        <span class="n">BigInteger</span> <span class="n">R_S</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">r_open</span><span class="p">));</span>
        <span class="n">R_S</span> <span class="o">=</span> <span class="n">R_S</span><span class="p">.</span><span class="na">modPow</span><span class="p">(</span><span class="n">S</span> <span class="p">,</span> <span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">P</span><span class="p">));</span>

        <span class="n">BigInteger</span> <span class="n">check</span> <span class="o">=</span> <span class="n">Y_R</span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="n">R_S</span><span class="p">).</span><span class="na">mod</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">P</span><span class="p">));</span>

        <span class="kt">long</span> <span class="n">message</span> <span class="o">=</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">hash</span><span class="p">.</span><span class="na">longValue</span><span class="p">(),</span> <span class="n">P</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;message = &quot;</span><span class="o">+</span><span class="n">message</span><span class="o">+</span><span class="s">&quot; check = &quot;</span><span class="o">+</span><span class="n">check</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">check</span><span class="p">.</span><span class="na">longValue</span><span class="p">()</span> <span class="o">!=</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">SignatureException</span><span class="p">(</span><span class="s">&quot;digital signature ElGamal is invalid&quot;</span><span class="p">);</span>
        <span class="p">}</span>
     <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setP</span><span class="p">(</span><span class="kt">long</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">P</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setG</span><span class="p">(</span><span class="kt">long</span> <span class="n">g</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">g</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getY</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">Y</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getR</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">BigInteger</span> <span class="nf">getS</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">S</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h3>Стандарты на цифровую подпись (ГОСТ Р34.10-94)<a class="headerlink" href="#id15" title="Ссылка на этот заголовок">¶</a></h3>
<p>Российский стандарт, как следует из его обозначения, был принят в 1994 году. В основе стандарта лежит по сути алгоритм, называемый DSA (Digital Signature Algorithm) и являющийся вариацией подписи Эль-Гамаля</p>
<p>Вначале для некоторого сообщества пользователей выбираются общие несекретные параметры. Прежде всего необходимо найти два простых числа, <em>q</em> длиной 256 бит и <em>p</em> длиной 1024 бита, между которыми выполняется соотношение</p>
<div class="math notranslate nohighlight">
\[p = bq + 1\]</div>
<p>для некоторого целого <em>b</em>. Старшие биты в <em>p</em> и <em>q</em> должны быть равны
единице. Затем выбирается число <span class="math notranslate nohighlight">\(a &gt; 1\)</span>, такое, что</p>
<div class="math notranslate nohighlight">
\[a^{q} \bmod p = 1\]</div>
<p>Далее, каждый пользователь выбирает случайно число x, удовлетворяющее неравенству <span class="math notranslate nohighlight">\(0 &lt; x &lt; q\)</span> , и вычисляет</p>
<div class="math notranslate nohighlight">
\[y = a^{x} \bmod p\]</div>
<p><strong>Число x будет секретным ключом пользователя, а число y — открытым ключом</strong></p>
<ol class="arabic simple">
<li><p>Вычисляем значение хеш-функции <span class="math notranslate nohighlight">\(h = h(m̄)\)</span> для сообщения m , значение хеш-функции должно лежать в пределах <span class="math notranslate nohighlight">\(0 &lt; h &lt; q\)</span> (в российском варианте хеш-функция определяется ГОСТом Р34.11-94)</p></li>
<li><p>Формируем случайное число k , <span class="math notranslate nohighlight">\(0 &lt; k &lt; q\)</span></p></li>
<li><p>Вычисляем <span class="math notranslate nohighlight">\(r = (a^{k} \bmod p) \bmod q\)</span> . Если оказывается так, что <span class="math notranslate nohighlight">\(r = 0\)</span>, то возвращаемся к шагу 2</p></li>
<li><p>Вычисляем <span class="math notranslate nohighlight">\(s = (kh + xr) \bmod q\)</span>. Если s = 0, то возвращаемся к шагу 2</p></li>
<li><p>Получаем подписанное сообщение <span class="math notranslate nohighlight">\(&lt;m̄; r, s&gt;\)</span>. Для проверки подписи делаем следующее:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Вычисляем хеш-функцию для сообщения <span class="math notranslate nohighlight">\(h = h(m̄)\)</span></p></li>
<li><p>Проверяем выполнение неравенств <span class="math notranslate nohighlight">\(0 &lt; r &lt; q , \ 0 &lt; s &lt; q\)</span></p></li>
<li><p>Вычисляем <span class="math notranslate nohighlight">\(u_1 = s · h^{−1} \bmod q , \ u_2 = −r · h^{−1} \bmod q\)</span></p></li>
<li><p>Вычисляем <span class="math notranslate nohighlight">\(v = (a^{u_1} y^{u_2} \bmod p) \bmod q\)</span></p></li>
<li><p>Проверяем выполнение равенства <span class="math notranslate nohighlight">\(u = r\)</span></p></li>
</ul>
</div></blockquote>
<p>Если хотя бы одна из проверок на шагах 2 и 5 не дает нужного результата, то подпись считается недействительной. Если же все проверки удачны, то подпись считается подлинной</p>
<p>Листинг программы:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DSA</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">BigInteger</span> <span class="n">P</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">BigInteger</span> <span class="n">Q</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">BigInteger</span> <span class="n">A</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">BigInteger</span> <span class="n">x</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">BigInteger</span> <span class="n">y</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">BigInteger</span> <span class="n">r</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">BigInteger</span> <span class="n">s</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">generateParameters</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">BigInteger</span> <span class="n">b</span><span class="p">,</span> <span class="n">temp_P</span><span class="p">;</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">do</span> <span class="p">{</span>
                <span class="n">Q</span> <span class="o">=</span> <span class="n">getRandomBigInteger</span><span class="p">(</span><span class="mi">16</span><span class="p">).</span><span class="na">add</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span>
            <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">Q</span><span class="p">.</span><span class="na">isProbablePrime</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
            <span class="k">do</span> <span class="p">{</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">getRandomBigInteger</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">P</span><span class="p">.</span><span class="na">isProbablePrime</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">P</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="na">divide</span><span class="p">(</span><span class="n">Q</span><span class="p">);</span>
            <span class="n">temp_P</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="n">Q</span><span class="p">).</span><span class="na">add</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">temp_P</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">P</span><span class="p">));</span>

        <span class="k">do</span> <span class="p">{</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">getRandomBigInteger</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">A</span><span class="p">.</span><span class="na">modPow</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">P</span><span class="p">).</span><span class="na">equals</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">ONE</span><span class="p">)</span> <span class="o">||</span> <span class="n">A</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">ONE</span><span class="p">));</span>
<span class="c1">//        System.out.println(&quot;p = &quot;+b+&quot; * &quot;+Q+&quot; + 1 = &quot;+P+&quot;\na = &quot;+A);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">DSA</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
        <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="n">x</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="n">Q</span><span class="p">.</span><span class="na">intValue</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="p">;</span>
           <span class="n">y</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="na">modPow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">);</span>
<span class="c1">//        System.out.println(&quot;X = &quot;+x+&quot; Y = &quot;+y);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">signFile</span><span class="p">(</span><span class="n">String</span> <span class="n">pathFile</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
        <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>

        <span class="n">String</span> <span class="n">checksumMD5</span> <span class="o">=</span> <span class="n">DigestUtils</span><span class="p">.</span><span class="na">md5Hex</span><span class="p">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">pathFile</span><span class="p">));</span>
        <span class="n">BigInteger</span> <span class="n">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">checksumMD5</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="n">hash</span> <span class="o">=</span> <span class="n">hash</span><span class="p">.</span><span class="na">mod</span><span class="p">(</span><span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">Q</span><span class="p">)));</span>
        <span class="kt">long</span> <span class="n">k</span><span class="p">;</span>
        <span class="k">do</span> <span class="p">{</span>
           <span class="n">k</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="n">Q</span><span class="p">.</span><span class="na">intValue</span><span class="p">()</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
           <span class="n">r</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="na">modPow</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">P</span><span class="p">).</span><span class="na">mod</span><span class="p">(</span><span class="n">Q</span><span class="p">);</span>
           <span class="n">s</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="n">r</span><span class="p">).</span><span class="na">add</span><span class="p">(</span><span class="n">hash</span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">k</span><span class="p">))).</span><span class="na">mod</span><span class="p">(</span><span class="n">Q</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span> <span class="o">||</span> <span class="n">s</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">ZERO</span><span class="p">));</span>
        <span class="n">writeDSASignToFile</span><span class="p">(</span><span class="s">&quot;DSA&quot;</span><span class="p">,</span><span class="n">r</span><span class="p">.</span><span class="na">intValue</span><span class="p">(),</span> <span class="n">s</span><span class="p">.</span><span class="na">intValue</span><span class="p">());</span>
<span class="c1">//        System.out.println(&quot; k = &quot;+k+&quot; r = &quot;+r+&quot; s = &quot;+s);</span>
    <span class="p">}</span>

   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkSign</span><span class="p">(</span><span class="n">String</span> <span class="n">pathFile</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">r_sign</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">s_sign</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">y_open</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">SignatureException</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">checksumMD5</span> <span class="o">=</span> <span class="n">DigestUtils</span><span class="p">.</span><span class="na">md5Hex</span><span class="p">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">pathFile</span><span class="p">));</span>
        <span class="n">BigInteger</span> <span class="n">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">checksumMD5</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="n">hash</span> <span class="o">=</span> <span class="n">hash</span><span class="p">.</span><span class="na">mod</span><span class="p">(</span><span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">Q</span><span class="p">)));</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">r_sign</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">s_sign</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
           <span class="k">throw</span> <span class="k">new</span> <span class="n">SignatureException</span><span class="p">(</span><span class="s">&quot;digital signature DSA is invalid&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kt">long</span><span class="o">[]</span> <span class="n">EuclidResult</span><span class="p">;</span>
        <span class="n">BigInteger</span> <span class="n">h_1</span><span class="p">;</span>

        <span class="k">do</span> <span class="p">{</span>
            <span class="n">EuclidResult</span> <span class="o">=</span>  <span class="n">Euclid</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">hash</span><span class="p">.</span><span class="na">longValue</span><span class="p">(),</span> <span class="n">Q</span><span class="p">.</span><span class="na">longValue</span><span class="p">());</span>
            <span class="n">h_1</span> <span class="o">=</span>  <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">EuclidResult</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">+</span> <span class="n">Q</span><span class="p">.</span><span class="na">longValue</span><span class="p">()));</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">hash</span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="n">h_1</span><span class="p">).</span><span class="na">mod</span><span class="p">(</span><span class="n">Q</span><span class="p">).</span><span class="na">equals</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">ONE</span><span class="p">)</span> <span class="p">);</span>

        <span class="n">BigInteger</span> <span class="n">u1</span> <span class="o">=</span> <span class="n">s_sign</span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="n">h_1</span><span class="p">).</span><span class="na">mod</span><span class="p">(</span><span class="n">Q</span><span class="p">);</span>
        <span class="n">BigInteger</span> <span class="n">u2</span> <span class="o">=</span> <span class="n">r_sign</span><span class="p">.</span><span class="na">negate</span><span class="p">().</span><span class="na">multiply</span><span class="p">(</span><span class="n">h_1</span><span class="p">).</span><span class="na">mod</span><span class="p">(</span><span class="n">Q</span><span class="p">);</span>

        <span class="n">BigInteger</span> <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="na">pow</span><span class="p">(</span><span class="n">u1</span><span class="p">.</span><span class="na">intValue</span><span class="p">()).</span><span class="na">multiply</span><span class="p">(</span><span class="n">y_open</span><span class="p">.</span><span class="na">pow</span><span class="p">(</span><span class="n">u2</span><span class="p">.</span><span class="na">intValue</span><span class="p">())).</span><span class="na">mod</span><span class="p">(</span><span class="n">P</span><span class="p">)).</span><span class="na">mod</span><span class="p">(</span><span class="n">Q</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">r_sign</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;r = &quot;</span><span class="o">+</span><span class="n">r_sign</span><span class="o">+</span><span class="s">&quot; v = &quot;</span><span class="o">+</span><span class="n">v</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">SignatureException</span><span class="p">(</span><span class="s">&quot;digital signature DSA is invalid&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">BigInteger</span> <span class="nf">getRandomBigInteger</span><span class="p">(</span><span class="kt">int</span> <span class="n">numBits</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">BigInteger</span> <span class="n">number</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">numBits</span><span class="p">,</span> <span class="k">new</span> <span class="n">Random</span><span class="p">());</span> <span class="c1">//Give you a number between 0 and 2^numBits - 1</span>
        <span class="k">return</span> <span class="n">number</span><span class="p">.</span><span class="na">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="n">BigInteger</span> <span class="nf">getR</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="n">BigInteger</span> <span class="nf">getS</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="n">BigInteger</span> <span class="nf">getY</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id16">
<h2>Глава 5. Криптографические протоколы<a class="headerlink" href="#id16" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="id17">
<h3>Ментальный покер(Пример на основе двух пользователей)<a class="headerlink" href="#id17" title="Ссылка на этот заголовок">¶</a></h3>
<p>Рассмотрим задачу проведения честной игры в карты, когда партнеры находятся далеко друг от друга, но связаны компьютерной сетью. Мы рассмотрим предельно упрощенную постановку задачи, где участвуют всего два игрока и всего три карты. Однако все основные идеи будут продемонстрированы, а обобщения на другие случаи очевидны</p>
<dl class="simple">
<dt>Задача ставится следующим образом. Имеются два игрока Алиса и Боб и три карты α , β , γ . Необходимо раздать карты следующим образом: Алиса должна получить одну карту, Боб — также одну, а одна карта должна остаться в прикупе. При этом необходимо, чтобы</dt><dd><ul class="simple">
<li><p>каждый игрок мог получить с равными вероятностями любую из трех карт α, или γ, а одна карта оказалась в прикупе</p></li>
<li><p>каждый игрок знал только свою карту, но не знал карту противника и карту в прикупе</p></li>
<li><p>в случае спора возможно было пригласить судью и выяснить, кто прав, кто виноват</p></li>
<li><p>при раздаче карт с помощью компьютерной сети никто не знал, кому какая карта досталась (хотя раздача происходит по открытой линии связи и Ева может записать все передаваемые сообщения)</p></li>
</ul>
</dd>
</dl>
<p>На предварительном этапе необходимо вычислить несекретное большое просто число <span class="math notranslate nohighlight">\(P\)</span>. Затем каждый абонент выбирает случайное число <span class="math notranslate nohighlight">\(C\)</span>, взаимно простое с <span class="math notranslate nohighlight">\(P-1\)</span> и вычисляет по обобщенному алгоритму Евклида (инверсия числа <span class="math notranslate nohighlight">\(С\)</span>) число <span class="math notranslate nohighlight">\(D\)</span>, так что</p>
<div class="math notranslate nohighlight">
\[C*D \bmod (P-1) = 1\]</div>
<p>Эти числа каждый игрок держит в секрете. Затем Алиса выбирает случайно три (различных) числа <span class="math notranslate nohighlight">\(α_p, β_p, γ_p\)</span> в промежутке от 1 до P − 1, в открытом виде передает их Бобу и сообщает, что <span class="math notranslate nohighlight">\(α_p\)</span> соответствует α (т. е., например, число 3756 соответствует тузу и т.д)</p>
<p>Далее начинается раздача карт:</p>
<p><strong>Шаг 1.</strong> Алиса вычисляет числа и предварительно перемешав их высылает Бобу</p>
<div class="math notranslate nohighlight">
\[\begin{split}u_1 = α_p^{C_A} \bmod p,  \\
u_2 = β_p^{C_A} \bmod p,  \\
u_3 = γ_p^{C_A} \bmod p,\end{split}\]</div>
<p><strong>Шаг 2.</strong> Боб получив числа, выбирает случайно одно из них и отправляет его Алисе. Это и будет карта, которая достанется ей в процессе раздачи</p>
<div class="math notranslate nohighlight">
\[u_p = u_2^{D_A} \bmod p = β_p^{C_A*D_A} \bmod p = β_p\]</div>
<p><strong>Шаг 3.</strong> Боб продолжает свои действия. Он вычисляет оставшиеся числа, предварительно перемешав</p>
<div class="math notranslate nohighlight">
\[\begin{split}v_1 = u_1^{C_B} \bmod p, \\
v_3 = u_3^{C_B} \bmod p,\end{split}\]</div>
<p><strong>Шаг 4.</strong> Алиса выбирает случайно одно из полученных чисел и вычисляет w и отправляет число Бобу</p>
<div class="math notranslate nohighlight">
\[w_1 = v_1^{D_A} \bmod p\]</div>
<p><strong>Шаг 5.</strong> Боб вычисляет cвою карту. Последняя карта γ идет в прикуп</p>
<div class="math notranslate nohighlight">
\[z = w_1^{D_B} \bmod p = w_1^{D_B} \bmod p = v_1^{D_A*D_B} \bmod p = u_1^{C_B*D_B*D_A} \bmod p = α_p^{C_A*C_B*D_B*D_A} \bmod p = α_p\]</div>
<p><strong>Схема взаимодействия</strong> α^ = <span class="math notranslate nohighlight">\(α_p\)</span>, β^ = <span class="math notranslate nohighlight">\(β_p\)</span>, γ^ = <span class="math notranslate nohighlight">\(γ_p\)</span>:</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/poker1.png"><img alt="memtal_poker" src="../../_images/poker1.png" style="width: 600px;" /></a>
</div>
</div></blockquote>
</div>
<div class="section" id="id18">
<h3>Многопользовательный ментальный покер<a class="headerlink" href="#id18" title="Ссылка на этот заголовок">¶</a></h3>
<p><strong>Схема взаимодействия</strong> (выбор 1 карты пользователем А) α^ = <span class="math notranslate nohighlight">\(α_p\)</span>, β^ = <span class="math notranslate nohighlight">\(β_p\)</span>, γ^ = <span class="math notranslate nohighlight">\(γ_p\)</span>:</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/Poker.png"><img alt="mental_poker" src="../../_images/Poker.png" style="width: 600px;" /></a>
</div>
</div></blockquote>
<p>В данной схеме используюется <em>Крупье</em></p>
<p><strong>Шаг 1.</strong> Каждый игрок шифрует колоду ключом С</p>
<div class="math notranslate nohighlight">
\[\begin{split}A: \ u_A = α_p^{C_A} \bmod p,  \\
B: \ u_{AB} = u_A^{C_B} \bmod p,  \\
C: \ u_{ABC} = u_{AB}^{C_C} \bmod p,\end{split}\]</div>
<p><strong>Шаг 2.</strong> Далее игроки передают зашифрованную колоду Крупье и крупье выдает карты (<span class="math notranslate nohighlight">\(u_i\)</span>), предварительно перемешав</p>
<p><strong>Шаг 3.</strong> Игрок А передает свою карту(<span class="math notranslate nohighlight">\(u_i\)</span>) другим игрокам для расшифровки</p>
<div class="math notranslate nohighlight">
\[\begin{split}u_B = u_i^{D_B} \bmod p \ - \ Пользователь \ B \\
u_{BC} = u_B^{D_C} \bmod p \ - \ Пользователь \ C\end{split}\]</div>
<p><strong>Шаг 3.</strong> Игрок А получив карту расшифровывает карту своим ключом и получает значение карты</p>
<div class="math notranslate nohighlight">
\[u_{ABC} = u_{BC}^{D_A} \bmod p = α_p\]</div>
<p>Листинг программы:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span> <span class="c1">// Class Player</span>
 <span class="kn">package</span> <span class="nn">laba4_mental_poker</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">laba1.Euclid</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">java.util.Random</span><span class="p">;</span>

 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Player</span> <span class="p">{</span>
   <span class="kd">private</span> <span class="n">String</span><span class="o">[]</span> <span class="n">cards</span><span class="p">;</span>
   <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>

   <span class="kd">private</span> <span class="kd">static</span> <span class="n">BigInteger</span> <span class="n">P</span><span class="p">;</span>
   <span class="kd">private</span> <span class="n">BigInteger</span> <span class="n">C</span><span class="p">;</span>
   <span class="kd">private</span> <span class="n">BigInteger</span> <span class="n">D</span><span class="p">;</span>

   <span class="kd">public</span> <span class="n">Cards</span> <span class="n">chargedDeck</span><span class="p">;</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">generateBigPrimeP</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">do</span> <span class="p">{</span>
           <span class="n">P</span> <span class="o">=</span> <span class="n">getRandomBigInteger</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
       <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">P</span><span class="p">.</span><span class="na">isProbablePrime</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="nf">Player</span><span class="p">(</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">Cards</span> <span class="n">deck</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">cards</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>
       <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
       <span class="n">chargedDeck</span> <span class="o">=</span> <span class="n">deck</span><span class="p">;</span>
       <span class="kt">long</span><span class="o">[]</span> <span class="n">EuclidResult</span><span class="p">;</span>
       <span class="n">BigInteger</span> <span class="n">temp_P</span> <span class="o">=</span> <span class="n">P</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
       <span class="k">do</span> <span class="p">{</span>
           <span class="k">do</span> <span class="p">{</span>
               <span class="n">C</span> <span class="o">=</span> <span class="n">getRandomBigInteger</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
               <span class="n">EuclidResult</span> <span class="o">=</span> <span class="n">Euclid</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="na">longValue</span><span class="p">(),</span> <span class="n">temp_P</span><span class="p">.</span><span class="na">longValue</span><span class="p">());</span>
           <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">EuclidResult</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">);</span>
           <span class="n">D</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">((</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">EuclidResult</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">+</span> <span class="n">temp_P</span><span class="p">.</span><span class="na">longValue</span><span class="p">())));</span>
       <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">C</span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="n">D</span><span class="p">).</span><span class="na">mod</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">temp_P</span><span class="p">.</span><span class="na">longValue</span><span class="p">())).</span><span class="na">equals</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="na">ONE</span><span class="p">));</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="nf">encryptCards</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="n">cards</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="n">uDeck</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">cards</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
       <span class="k">for</span> <span class="p">(</span><span class="n">BigInteger</span> <span class="n">card</span> <span class="p">:</span> <span class="n">cards</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">uDeck</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">card</span><span class="p">.</span><span class="na">modPow</span><span class="p">(</span><span class="n">getC</span><span class="p">(),</span> <span class="n">P</span><span class="p">));</span>
       <span class="p">}</span>
       <span class="n">Collections</span><span class="p">.</span><span class="na">shuffle</span><span class="p">(</span><span class="n">uDeck</span><span class="p">);</span>
       <span class="k">return</span> <span class="n">uDeck</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="nf">decryptCards</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="n">cards</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="n">uDeck</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">cards</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
       <span class="k">for</span> <span class="p">(</span><span class="n">BigInteger</span> <span class="n">card</span> <span class="p">:</span> <span class="n">cards</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">uDeck</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">card</span><span class="p">.</span><span class="na">modPow</span><span class="p">(</span><span class="n">getD</span><span class="p">(),</span> <span class="n">P</span><span class="p">));</span>
       <span class="p">}</span>
       <span class="n">Collections</span><span class="p">.</span><span class="na">shuffle</span><span class="p">(</span><span class="n">uDeck</span><span class="p">);</span>
       <span class="k">return</span> <span class="n">uDeck</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">seeCards</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="n">cards</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\tPlayer &quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">&quot;: key = &quot;</span><span class="o">+</span><span class="n">getD</span><span class="p">());</span>
       <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cards</span><span class="p">.</span><span class="na">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
           <span class="k">this</span><span class="p">.</span><span class="na">cards</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">chargedDeck</span><span class="p">.</span><span class="na">deckInterpreter</span><span class="p">(</span><span class="n">chargedDeck</span><span class="p">.</span><span class="na">deck</span><span class="p">,</span> <span class="n">cards</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
           <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot; &lt; &quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="na">cards</span><span class="o">[</span><span class="n">i</span><span class="o">]+</span><span class="s">&quot; &gt;&quot;</span><span class="p">);</span>
       <span class="p">}</span>
       <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">);</span>
   <span class="p">}</span>


   <span class="kd">public</span> <span class="kd">static</span> <span class="n">BigInteger</span> <span class="nf">getRandomBigInteger</span><span class="p">(</span><span class="kt">int</span> <span class="n">numBits</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">BigInteger</span> <span class="n">number</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">numBits</span><span class="p">,</span> <span class="k">new</span> <span class="n">Random</span><span class="p">());</span>
       <span class="k">return</span> <span class="n">number</span><span class="p">.</span><span class="na">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="n">BigInteger</span> <span class="nf">getC</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">C</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="kd">public</span> <span class="n">BigInteger</span> <span class="nf">getD</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">D</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="n">BigInteger</span> <span class="nf">getP</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">P</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="kd">public</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getCards</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">cards</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCards</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">cards</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">this</span><span class="p">.</span><span class="na">cards</span> <span class="o">=</span> <span class="n">cards</span><span class="p">;</span>
   <span class="p">}</span>
 <span class="p">}</span>


 <span class="c1">// Class Cards</span>
 <span class="kn">package</span> <span class="nn">laba4_mental_poker</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">java.security.SecureRandom</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>

 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cards</span> <span class="p">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">NUM_OF_CARDS</span> <span class="o">=</span> <span class="mi">52</span><span class="p">;</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">NUM_OF_SUITS</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">NUM_OF_VALUES</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>

   <span class="kd">public</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">suitName</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">NUM_OF_SUITS</span><span class="p">);</span>
   <span class="kd">public</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">valuesName</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">NUM_OF_VALUES</span><span class="p">);</span>

   <span class="kd">public</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="n">deck</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span><span class="p">(</span><span class="n">NUM_OF_CARDS</span><span class="p">);</span>

   <span class="kd">public</span> <span class="nf">Cards</span><span class="p">()</span> <span class="p">{</span>
       <span class="n">suitName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;Hearts&quot;</span><span class="p">);</span>
       <span class="n">suitName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;Diamonds&quot;</span><span class="p">);</span>
       <span class="n">suitName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;Spades&quot;</span><span class="p">);</span>
       <span class="n">suitName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;Clubs&quot;</span><span class="p">);</span>

       <span class="n">valuesName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;two&quot;</span><span class="p">);</span>
       <span class="n">valuesName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;three&quot;</span><span class="p">);</span>
       <span class="n">valuesName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;four&quot;</span><span class="p">);</span>
       <span class="n">valuesName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;five&quot;</span><span class="p">);</span>
       <span class="n">valuesName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;six&quot;</span><span class="p">);</span>
       <span class="n">valuesName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;seven&quot;</span><span class="p">);</span>
       <span class="n">valuesName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;eight&quot;</span><span class="p">);</span>
       <span class="n">valuesName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;nine&quot;</span><span class="p">);</span>
       <span class="n">valuesName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;ten&quot;</span><span class="p">);</span>
       <span class="n">valuesName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;jack&quot;</span><span class="p">);</span>
       <span class="n">valuesName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;queen&quot;</span><span class="p">);</span>
       <span class="n">valuesName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;king&quot;</span><span class="p">);</span>
       <span class="n">valuesName</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;ace&quot;</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initDeck</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">P</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
       <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
       <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_OF_CARDS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">deck</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="na">intValue</span><span class="p">()</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)));</span>
       <span class="p">}</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="n">String</span> <span class="nf">deckInterpreter</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="n">cardDeck</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">cardValue</span><span class="p">)</span> <span class="p">{</span>
       <span class="kt">int</span> <span class="n">suit</span><span class="p">,</span><span class="n">value</span><span class="p">;</span>
       <span class="n">String</span> <span class="n">cardName</span><span class="p">;</span>
       <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_OF_CARDS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
           <span class="k">if</span> <span class="p">(</span><span class="n">cardDeck</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="na">equals</span><span class="p">(</span><span class="n">cardValue</span><span class="p">))</span> <span class="p">{</span>
               <span class="n">suit</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">NUM_OF_VALUES</span><span class="p">;</span>
               <span class="n">value</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">NUM_OF_VALUES</span><span class="p">;</span>
               <span class="n">cardName</span> <span class="o">=</span> <span class="n">valuesName</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">suitName</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">suit</span><span class="p">);</span>
               <span class="k">return</span> <span class="n">cardName</span><span class="p">;</span>
           <span class="p">}</span>
       <span class="p">}</span>
       <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
   <span class="p">}</span>
 <span class="p">}</span>

 <span class="c1">// Class Croupier</span>
 <span class="kn">package</span> <span class="nn">laba4_mental_poker</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">java.security.SecureRandom</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>

 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Croupier</span> <span class="p">{</span>

   <span class="kd">public</span> <span class="n">BigInteger</span> <span class="n">P</span><span class="p">;</span>
   <span class="kd">public</span> <span class="n">Cards</span> <span class="n">chargedDeck</span><span class="p">;</span>
   <span class="kd">private</span> <span class="n">String</span><span class="o">[]</span> <span class="n">buyIn</span><span class="p">;</span>

   <span class="kd">public</span> <span class="nf">Croupier</span><span class="p">(</span><span class="n">Cards</span> <span class="n">deck</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">P</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">this</span><span class="p">.</span><span class="na">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">;</span>
       <span class="n">buyIn</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">;</span>
       <span class="n">chargedDeck</span> <span class="o">=</span> <span class="n">deck</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="nf">chooseCard</span> <span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="n">cards</span><span class="p">,</span> <span class="kt">int</span> <span class="n">numOfCards</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="n">selectedCards</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">numOfCards</span><span class="p">);</span>
       <span class="kt">int</span> <span class="n">randomInteger</span><span class="p">;</span>
       <span class="n">SecureRandom</span> <span class="n">srand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="p">();</span>
       <span class="n">srand</span><span class="p">.</span><span class="na">setSeed</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>

       <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numOfCards</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">randomInteger</span> <span class="o">=</span> <span class="n">srand</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="n">cards</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
           <span class="n">selectedCards</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">cards</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">randomInteger</span><span class="p">));</span>
           <span class="n">cards</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">randomInteger</span><span class="p">);</span>
       <span class="p">}</span>
       <span class="k">return</span> <span class="n">selectedCards</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">seeBuyIN</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="n">cards</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\t\tTable Deck &quot;</span><span class="p">);</span>
       <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cards</span><span class="p">.</span><span class="na">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
           <span class="k">this</span><span class="p">.</span><span class="na">buyIn</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">chargedDeck</span><span class="p">.</span><span class="na">deckInterpreter</span><span class="p">(</span><span class="n">chargedDeck</span><span class="p">.</span><span class="na">deck</span><span class="p">,</span> <span class="n">cards</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
           <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot; &lt; &quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="na">buyIn</span><span class="o">[</span><span class="n">i</span><span class="o">]+</span><span class="s">&quot; &gt;&quot;</span><span class="p">);</span>
       <span class="p">}</span>
       <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">);</span>
   <span class="p">}</span>
 <span class="p">}</span>

 <span class="c1">// Main</span>
<span class="kn">package</span> <span class="nn">laba4_mental_poker</span><span class="p">;</span>

 <span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="p">;</span>
 <span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>

 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="p">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
       <span class="kt">int</span> <span class="n">numPlayers</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
       <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="n">uiDeck</span><span class="p">,</span> <span class="n">buyIn</span><span class="p">;</span>
       <span class="n">Player</span><span class="p">.</span><span class="na">generateBigPrimeP</span><span class="p">();</span>

       <span class="n">Cards</span> <span class="n">cards</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cards</span><span class="p">();</span>
       <span class="n">cards</span><span class="p">.</span><span class="na">initDeck</span><span class="p">(</span><span class="n">Player</span><span class="p">.</span><span class="na">getP</span><span class="p">());</span>

       <span class="n">Player</span><span class="o">[]</span> <span class="n">players</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Player</span><span class="o">[</span><span class="n">numPlayers</span><span class="o">]</span><span class="p">;</span>
       <span class="n">Croupier</span> <span class="n">croupier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Croupier</span><span class="p">(</span><span class="n">cards</span><span class="p">,</span> <span class="n">Player</span><span class="p">.</span><span class="na">getP</span><span class="p">());</span>

       <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numPlayers</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">players</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Player</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">cards</span><span class="p">);</span>
       <span class="p">}</span>

       <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">BigInteger</span><span class="o">&gt;</span> <span class="n">uDeck</span> <span class="o">=</span> <span class="n">cards</span><span class="p">.</span><span class="na">deck</span><span class="p">;</span>

       <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numPlayers</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">uDeck</span> <span class="o">=</span> <span class="n">players</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">encryptCards</span><span class="p">(</span><span class="n">uDeck</span><span class="p">);</span>
       <span class="p">}</span>

       <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numPlayers</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">uiDeck</span> <span class="o">=</span> <span class="n">croupier</span><span class="p">.</span><span class="na">chooseCard</span><span class="p">(</span><span class="n">uDeck</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
           <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">numPlayers</span><span class="p">;</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">;</span> <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">numPlayers</span><span class="p">)</span> <span class="p">{</span>
               <span class="n">uiDeck</span> <span class="o">=</span>  <span class="n">players</span><span class="o">[</span><span class="n">j</span><span class="o">]</span><span class="p">.</span><span class="na">decryptCards</span><span class="p">(</span><span class="n">uiDeck</span><span class="p">);</span>
           <span class="p">}</span>
           <span class="n">players</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">seeCards</span><span class="p">(</span><span class="n">players</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">decryptCards</span><span class="p">(</span><span class="n">uiDeck</span><span class="p">));</span>
       <span class="p">}</span>

       <span class="n">buyIn</span> <span class="o">=</span> <span class="n">croupier</span><span class="p">.</span><span class="na">chooseCard</span><span class="p">(</span><span class="n">uDeck</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
       <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numPlayers</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">buyIn</span> <span class="o">=</span>  <span class="n">players</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">decryptCards</span><span class="p">(</span><span class="n">buyIn</span><span class="p">);</span>
       <span class="p">}</span>
       <span class="n">croupier</span><span class="p">.</span><span class="na">seeBuyIN</span><span class="p">(</span><span class="n">buyIn</span><span class="p">);</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h3>Электронные деньги (Слепая подпись)<a class="headerlink" href="#id19" title="Ссылка на этот заголовок">¶</a></h3>
<p><strong>Первая плохая схема</strong></p>
<p>Во многих странах люди оплачивают покупки при помощи электронных карточек, заказывают авиабилеты через Интернет, покупают самые разнообразные товары в Интернет-магазинах. Сведения о покупках накапливаются в магазинах и банках. Поэтому появилась новая проблема, иногда называемая «проблема Большого Брата». Суть проблемы состоит в том, что исчезает анонимность процесса покупки, т.е. информация о покупках любого человека может стать известной третьим лицам и использоваться против него</p>
<p>Мы рассмотрим две «плохие» схемы, а затем «хорошую», чтобы было легче понять суть метода. Вначале дадим более точную постановку задачи. Имеются три
участника: банк, покупатель и магазин. Покупатель и магазин имеют соответствующие счета в банке, и покупатель хочет купить некоторый товар в магазине. Покупка осуществляется в виде трехступенчатого процесса:</p>
<ol class="arabic simple">
<li><p>покупатель снимает нужную сумму со своего счета в банке</p></li>
<li><p>покупатель «пересылает» деньги в магазин</p></li>
<li><p>магазин сообщает об этом в банк, соответствующая сумма денег зачисляется на счет магазина, а покупатель забирает товар(или последний ему доставляется)</p></li>
</ol>
<p>Наша цель — разработать такую схему, чтобы</p>
<blockquote>
<div><ul class="simple">
<li><p>она была надежна</p></li>
<li><p>чтобы банк не знал, кто купил товар, т.е. была сохранена ано нимность обычных дене</p></li>
</ul>
</div></blockquote>
<p>Опишем первую «плохую» схему (она базируется на RSA). Банк имеет следующую информацию: секретные числа P , Q, C и открытые</p>
<div class="math notranslate nohighlight">
\[\begin{split}N = PQ, \\
d = c^{-1} \bmod (P-1)(Q-1)\end{split}\]</div>
<p>Допустим, покупатель решил израсходовать некоторую заранее оговоренную с банком сумму (например, 100$). (Мы сначала рассмотрим случай, когда может использоваться «банкнота» только одного номинала (скажем, 100$).) Покупатель высылает в банк число n , которое будет номером банкноты (обычно требуется, чтобы генерировалось случайное число в промежутке [2, N − 1]).
Банк вычисляет число:</p>
<div class="math notranslate nohighlight">
\[s = n^{C} \bmod N\]</div>
<p>и формирует банкноту <span class="math notranslate nohighlight">\(&lt;n, s&gt;\)</span>, которую возвращает покупателю, предварительно уменьшив его счет на 100$. Параметр s в банкноте это подпись банка. Никто не может подделать подпись, так как число c секретно. Покупатель предъявляет банкноту <span class="math notranslate nohighlight">\(&lt;n, s&gt;\)</span> в магазине, чтобы купить товар. Магазин отправляет эту банкноту в банк для проверки. Прежде всего, банк проверяет правильность подписи (эту проверку мог бы сделать и магазин, используя открытые ключи банка). Но кроме этого банк хранит все номера возвратившихся к нему банк-нот и проверяет, нет ли числа n в этом списке. Если n есть в списке, то платеж не принимается (кто-то пытается использовать банкноту повторно), и банк сообщает об этом магазину. Если же все проверки прошли успешно, то банк добавляет 100$ на счет магазина, а магазин отпускает товар покупателю.</p>
<p>Недостаток этой схемы — отсутствует анонимность. Банк, а также все, кто имеет доступ к открытым линиям связи, могут запомнить, какому покупателю соответствует число n , и тем самым выяснить, кто купил товар.</p>
<p><strong>Вторая плохая схема</strong></p>
<p>Рассмотрим вторую «плохую» схему, которая уже обеспечивает анонимность. Эта схема базируется на так называемой «слепой подписи». Снова покупатель хочет купить товар. Он генерирует число n ,которое теперь не будет посылаться в банк. Затем он генерирует случайное число r , взаимно простое с N , и вычисляет число</p>
<div class="math notranslate nohighlight">
\[n̂ = (n*r^{d}) \bmod N\]</div>
<p>Число n̂ покупатель отправляет в банк.
Банк вычисляет число</p>
<div class="math notranslate nohighlight">
\[ŝ = (n̂^{c}) \bmod N\]</div>
<p>и отправляет ŝ обратно покупателю (не забыв при этом снять 100$ с его счета). Покупатель находит число <span class="math notranslate nohighlight">\(r^{-1}\)</span> mod N и вычисляет</p>
<div class="math notranslate nohighlight">
\[s = (ŝ*r^{-1}) \bmod N
s = n̂ * r^{-1}\]</div>
<p>Мы получили подпись банка к n , но самого числа n ни банк, ни кто либо другой не видел. Вычисление называется «слепой подписью», так как реальное сообщение ( n ) подписывающий не видит и узнать не может. Таким образом, покупатель имеет число n , которое никому неизвестно и никогда не передавалось по каналам связи. Покупатель формирует банкноту <span class="math notranslate nohighlight">\(&lt;n, s&gt;\)</span> и действует так же, как в первой «плохой» схеме. Но теперь никто не знает, кому соответствует эта банкнота, т.е. она стала анонимной, как обычная бумажная банкнота</p>
<p>Почему же данная схема плохая? Она имеет следующий недостаток: можно сфабриковать фальшивую банкноту, если известны хотя бы две настоящие. Делается это так. Путь злоумышленник (будь то покупатель или магазин) имеет две настоящие банкноты. Тогда он легко сможет изготовить фальшивую банкноту, вычислив числа</p>
<div class="math notranslate nohighlight">
\[\begin{split}n_3 = n_1*n_2 \bmod N \\
s_3 = s_1*s_2 \bmod N \\
n_3^{c} = (n_1*n_2)^{c} = n_1^{c}*n_2^{c} = s_1*s_2 = s_3 \bmod N\end{split}\]</div>
<p><strong>Хорошая схема</strong></p>
<p>Банкнота теперь определяется как пара чисел  <span class="math notranslate nohighlight">\(&lt;n, s_f&gt;\)</span>, где подписывается не n, а f(n)</p>
<div class="math notranslate nohighlight">
\[s_f = (f(n))^{c} \bmod N\]</div>
<p>Для проверки подписи банком необходимо</p>
<div class="math notranslate nohighlight">
\[s_f^{d} \bmod N = f(n)\]</div>
<p>Заметим, что при выборе односторонней функции нужно проявлять осторожность. Например, функция <span class="math notranslate nohighlight">\(f(n) = n^2 \bmod N\)</span>, которая действительно является односторонней, не годится для рассматриваемого протокола. Читатель может проверить, что банкноты, созданные с использованием такой функции, будут по-прежнему обладать мультипликативным свойством как во второй плохой схеме. На практике в качестве f(n) обычно используются криптографичесие хеш-функции</p>
<p><strong>Реализация «слепой подписи» на основе голосования</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Client.java</span>
<span class="kn">package</span> <span class="nn">laba5_blind_signature</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">laba1.powMod</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">laba3.RSAsign</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.codec.digest.DigestUtils</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="p">;</span>

<span class="kn">import static</span> <span class="nn">laba2.FileManipulation.writeIntSignToFile</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">BigInteger</span> <span class="n">C</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">BigInteger</span> <span class="n">D</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">BigInteger</span> <span class="n">N</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">BigInteger</span> <span class="n">r</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Bulletin</span> <span class="n">bulletin</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">Client</span><span class="p">(</span><span class="n">Bulletin</span> <span class="n">bulletin</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="na">bulletin</span> <span class="o">=</span> <span class="n">bulletin</span><span class="p">;</span>
      <span class="n">RSAsign</span> <span class="n">rsa</span>  <span class="o">=</span> <span class="k">new</span> <span class="n">RSAsign</span><span class="p">();</span>
      <span class="n">C</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">rsa</span><span class="p">.</span><span class="na">getC</span><span class="p">()));</span>
      <span class="n">D</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">rsa</span><span class="p">.</span><span class="na">getD</span><span class="p">()));</span>
      <span class="n">N</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">rsa</span><span class="p">.</span><span class="na">getN</span><span class="p">()));</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;C = &quot;</span><span class="o">+</span><span class="n">rsa</span><span class="p">.</span><span class="na">getC</span><span class="p">()</span><span class="o">+</span><span class="s">&quot; D = &quot;</span><span class="o">+</span><span class="n">rsa</span><span class="p">.</span><span class="na">getD</span><span class="p">()</span><span class="o">+</span><span class="s">&quot; N = &quot;</span><span class="o">+</span><span class="n">rsa</span><span class="p">.</span><span class="na">getN</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">answerQuestion</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">bulletin</span><span class="p">.</span><span class="na">getFullQuestion</span><span class="p">());</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">bulletin</span><span class="p">.</span><span class="na">getPossibleAnswer</span><span class="p">().</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="s">&quot;.&quot;</span><span class="o">+</span><span class="n">bulletin</span><span class="p">.</span><span class="na">getPossibleAnswer</span><span class="p">()</span><span class="o">[</span><span class="n">i</span><span class="o">]+</span><span class="s">&quot; &quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">Scanner</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot;-&gt; &quot;</span><span class="p">);</span>
      <span class="kt">int</span> <span class="n">choice</span> <span class="o">=</span> <span class="n">in</span><span class="p">.</span><span class="na">nextInt</span><span class="p">();</span>
      <span class="n">message</span> <span class="o">=</span> <span class="n">bulletin</span><span class="p">.</span><span class="na">getFullQuestion</span><span class="p">()</span><span class="o">+</span><span class="s">&quot; - &quot;</span><span class="o">+</span><span class="n">bulletin</span><span class="p">.</span><span class="na">getPossibleAnswer</span><span class="p">()</span><span class="o">[</span><span class="n">choice</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">BigInteger</span> <span class="nf">HashOfAnswer</span> <span class="p">()</span> <span class="p">{</span>
      <span class="n">String</span> <span class="n">checksumMD5</span> <span class="o">=</span> <span class="n">DigestUtils</span><span class="p">.</span><span class="na">md5Hex</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
      <span class="n">BigInteger</span> <span class="n">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">checksumMD5</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">hash</span><span class="p">.</span><span class="na">mod</span><span class="p">(</span><span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">N</span><span class="p">)));</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getSignBulletin</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">hash</span><span class="p">){</span>
      <span class="kt">long</span> <span class="n">S</span> <span class="o">=</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">hash</span><span class="p">.</span><span class="na">longValue</span><span class="p">(),</span> <span class="n">C</span><span class="p">.</span><span class="na">longValue</span><span class="p">(),</span> <span class="n">N</span><span class="p">.</span><span class="na">longValue</span><span class="p">());</span>
      <span class="n">writeIntSignToFile</span><span class="p">(</span><span class="s">&quot;blind&quot;</span><span class="p">,(</span><span class="kt">int</span><span class="p">)</span><span class="n">S</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">S</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">BigInteger</span> <span class="nf">getD</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">D</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">BigInteger</span> <span class="nf">getN</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">N</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Bulletin.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bulletin</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">possibleAnswer</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">fullQuestion</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">Bulletin</span><span class="p">(</span><span class="n">String</span> <span class="n">fullQuestion</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">possibleAnswer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;Yes&quot;</span><span class="p">,</span> <span class="s">&quot;No&quot;</span><span class="p">,</span> <span class="s">&quot;Refrain&quot;</span><span class="p">};</span>
      <span class="k">this</span><span class="p">.</span><span class="na">fullQuestion</span> <span class="o">=</span> <span class="n">fullQuestion</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getPossibleAnswer</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">possibleAnswer</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFullQuestion</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">fullQuestion</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Commission.java</span>
<span class="kn">package</span> <span class="nn">laba5_blind_signature</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Commission</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Bulletin</span> <span class="nf">askQuestion</span><span class="p">(</span><span class="n">String</span> <span class="n">question</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">Bulletin</span><span class="p">(</span><span class="n">question</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//Server.java</span>
<span class="kn">package</span> <span class="nn">laba5_blind_signature</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">laba1.powMod</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Server</span> <span class="p">{</span>

  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">checkSignature</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">hash</span><span class="p">,</span> <span class="kt">long</span> <span class="n">S</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">D</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">long</span> <span class="n">w</span> <span class="o">=</span> <span class="n">powMod</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">D</span><span class="p">.</span><span class="na">longValue</span><span class="p">(),</span> <span class="n">N</span><span class="p">.</span><span class="na">longValue</span><span class="p">());</span>

      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;message hash = &quot;</span><span class="o">+</span><span class="n">hash</span><span class="o">+</span><span class="s">&quot; w hash = &quot;</span><span class="o">+</span><span class="n">w</span><span class="p">);</span>

      <span class="k">return</span> <span class="n">w</span> <span class="o">==</span> <span class="n">hash</span><span class="p">.</span><span class="na">longValue</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//Main.java</span>
<span class="kn">package</span> <span class="nn">laba5_blind_signature</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">BigInteger</span> <span class="n">hash</span><span class="p">;</span>
      <span class="kt">long</span> <span class="n">ClientSignature</span><span class="p">;</span>
      <span class="n">Bulletin</span> <span class="n">bulletin</span> <span class="o">=</span> <span class="n">Commission</span><span class="p">.</span><span class="na">askQuestion</span><span class="p">(</span><span class="s">&quot;Putin is great?&quot;</span><span class="p">);</span>

      <span class="n">Client</span> <span class="n">Valera</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Client</span><span class="p">(</span><span class="n">bulletin</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Answer = &quot;</span><span class="o">+</span><span class="n">Valera</span><span class="p">.</span><span class="na">answerQuestion</span><span class="p">());</span>
      <span class="n">hash</span> <span class="o">=</span> <span class="n">Valera</span><span class="p">.</span><span class="na">HashOfAnswer</span><span class="p">();</span>
      <span class="n">ClientSignature</span> <span class="o">=</span> <span class="n">Valera</span><span class="p">.</span><span class="na">getSignBulletin</span><span class="p">(</span><span class="n">hash</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Client signature = &quot;</span><span class="o">+</span><span class="n">ClientSignature</span><span class="p">);</span>

      <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">();</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="na">checkSignature</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="n">ClientSignature</span><span class="p">,</span> <span class="n">Valera</span><span class="p">.</span><span class="na">getD</span><span class="p">(),</span> <span class="n">Valera</span><span class="p">.</span><span class="na">getN</span><span class="p">()));</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id20">
<h2>Протокол доказательства с нулевым знанием для задачи «Гамильтонов цикл»<a class="headerlink" href="#id20" title="Ссылка на этот заголовок">¶</a></h2>
<p>В реализации протокола необходимо информацию о графах считывать из файла. В файле описание графа будет определяться следующим
образом:</p>
<blockquote>
<div><ul class="simple">
<li><p>в первой строке файла содержатся два числа <span class="math notranslate nohighlight">\(n &lt; 1001 \ и \ m &lt;= n^{2}\)</span> количество вершин графа и количество рѐбер соответственно</p></li>
<li><p>в последующих m строках содержится информация о рѐбрах графа, каждое из которых описывается с помощью двух чисел (номера вершин, соединяемых этим ребром)</p></li>
<li><p>в зависимости от варианта указывается необходимая дополнительная информация: в первом варианте перечисляются цвета вершин графа; во втором варианте указывается последовательность вершин, задающая гамильтонов цикл (этот пункт можно вынести в отдельный файл)</p></li>
</ul>
</div></blockquote>
<div class="section" id="id21">
<h3>Доказательство с нулевым знанием<a class="headerlink" href="#id21" title="Ссылка на этот заголовок">¶</a></h3>
<p>Рассмотрим следующую задачу, возникающую в некоторых криптографических приложениях. Снова участвуют Алиса и Боб. Алиса знает решение некоторой сложной задачи, она хочет убедить Боба в этом, однако так, чтобы Боб не узнал самого решения задачи. Т.е. в результате Боб должен убедиться в том, что Алиса знает решение, но не должен узнать что-нибудь о самом решении. На первый взгляд сама задача кажется абсурдной, а возможность ее решения —
фантастической! Для того чтобы лучше понять ситуацию, рассмотрим случай из жизни пиратов. Пусть, например, Алиса знает карту острова, где спрятан клад, а Боб — капитан корабля, который может доставить ее на остров. Алиса хочет доказать, что карта у нее есть, не показывая ее Бобу (иначе Боб обойдется без Алисы, и весь клад достанется ему)</p>
<p>В качестве сложной задачи, решение которой известно Алисе, мы рассмотрим задачу нахождения гамильтонова цикла в графе с более сложным в идейном плане (чем задача раскраски графа), но более эффективным в плане реализации протоколом доказательства. Отметим, что обе задачи — раскраски графа тремя красками
и нахождения гамильтонова цикла — являются NP-полными. Мы не приводим формального определения NP-полноты, которое может быть найдено. Для читателя, не знакомого с этим определением, отметим только, что NP-полнота задачи неформально означает, что время решения задачи растет экспоненциально с ростом размера задачи (объема исходных данных)</p>
</div>
<div class="section" id="id22">
<h3>Гамильтонов цикл<a class="headerlink" href="#id22" title="Ссылка на этот заголовок">¶</a></h3>
<p><em>Гамильтоновым циклом</em> в графе называется непрерывный путь, проходящий через все вершины графа ровно по одному разу</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/cycle.png"><img alt="gamilton_cycle" src="../../_images/cycle.png" style="width: 250px;" /></a>
</div>
</div></blockquote>
<p>Путь, проходящий последовательно через вершины 8, 2, 4, 6, 3, 5, 7, 1, представляет собой гамильтонов цикл. Действительно, в этом пути содержатся все вершины графа, и каждая вершина посещается только один раз</p>
</div>
<div class="section" id="id23">
<h3>Ход алгоритма<a class="headerlink" href="#id23" title="Ссылка на этот заголовок">¶</a></h3>
<p><strong>Шаг 1.</strong>
Алиса строит граф <em>H</em> , являющийся копией исходного графа <em>G</em>, где у всех вершин новые, случайно выбранные номера. На языке теории графов говорят, что <em>H</em> изоморфен <em>G</em>. Иными словами, <em>H</em> получается путем некоторой перестановки вершин в графе <em>G</em> (с сохранением связей между вершинами). Алиса кодирует матрицу <em>H</em>, приписывая к первоначально содержащимся в ней нулям и единицам случайные числа <span class="math notranslate nohighlight">\(r_{ij}\)</span> по схеме <span class="math notranslate nohighlight">\(Hr_{ij} = r_{ij} \parallel H_{ij}\)</span>. Затем она шифрует элементы матрицы <em>H̃</em>, получая зашифрованную матрицу <span class="math notranslate nohighlight">\(F , F_{ij} = Hr_{ij}^{d} \bmod N\)</span>. Матрицу F Алиса передает Бобу</p>
<dl class="simple">
<dt><strong>Шаг 2.</strong> Боб, получив зашифрованный граф F, задает Алисе один из двух вопросов:</dt><dd><ol class="arabic simple">
<li><p>Каков гамильтонов цикл для графа H ?</p></li>
<li><p>Действительно ли граф H изоморфен G ?</p></li>
</ol>
</dd>
<dt><strong>Шаг 3.</strong> Алиса отвечает на соответствующий вопрос Боба:</dt><dd><ol class="arabic simple">
<li><p>Она расшифровывает в F ребра, образующие гамильтонов цикл</p></li>
<li><p>Она расшифровывает F полностью (фактически передает Бобу граф Hr ) и предъявляет перестановки, с помощью которых граф H был получен из графа G</p></li>
</ol>
</dd>
</dl>
<p><strong>Шаг 4.</strong> Получив ответ, Боб проверяет правильность расшифровки путем повторного шифрования и сравнения с F и убеждается либо в том, что показанные ребра действительно образуют гамильтонов цикл, либо в том, что предъявленные перестановки действительно переводят граф G в граф H</p>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<ul class="simple">
<li><p><strong>Зачем Алиса строит изоморфный граф?</strong> Если бы она этого не делала, то Боб, получив ответ на свой вопрос номер один, узнал бы гамильтонов цикл в графе G</p></li>
<li><p><strong>Зачем Алиса кодирует матрицу H?</strong> С этим приемом мы уже встречались при шифровании цветов вершин графа. Дело в том, что невозможно зашифровать непосредственно нули и единицы (с помощью шифра RSA они вообще не шифруются). Даже если заменить их на какие-то произвольные числа a и b, то мы получим всего два различных шифротекста, и Бобу не составит труда понять, какой из них какому числу соответствует. Т.е. структура графа не будет скрыта. Здесь мы сталкиваемся с типичной ситуацией, когда требуется использовать так называемый рандомизированный шифр. И такой шифр строится путем добавления случайных чисел в матрицу H перед шифрованием. Закодированная матрица H̃ точно также задает граф (нечетность числа означает наличие ребра, четность — его отсутствие), но после шифрования H̃ структура графа полностью скрывается</p></li>
<li><p><strong>Зачем Боб задает два вопроса?</strong> Если бы он задавал только вопрос номер один, который по смыслу протокола является основным, то Алиса, не зная в действительности гамильтонова цикла в графе G , могла бы предъявить Бобу совсем другой граф с таким же количеством вершин и искуственно заложенным в него гамильтоновым циклом. Поэтому Боб иногда просит Алису доказать изоморфизм графов H и G .**Важно, что Алиса не знает заранее, какой из двух вопросов задаст Боб**</p></li>
<li><p><strong>Почему Боб не может задать сразу двух вопросов?</strong> В этом случае он узнал бы гамильтонов цикл в G , так как ему был бы показан гамильтонов цикл в H и правило перехода от H к G</p></li>
<li><p><strong>Зачем Боб проверяет правильность расшифровки?</strong> Если бы он этого не делал, то Алиса на четвертом шаге могла бы предоставить ему «выгодную» для себя информацию, а не ту, которую она посылала ему на втором шаге</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="id24">
<h2>Используемая литература<a class="headerlink" href="#id24" title="Ссылка на этот заголовок">¶</a></h2>
<p><a class="reference external" href="ryabko_fionov_kriptograficheskie_metody_zashchity_i.pdf">Б.Я. Рябко, А.Н. Фионов. «Криптографические методы защиты информации»</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Авторские права 2020, Bulatov Alexandr

    </p>
  </div>
    
    
    
    Собрано при помощи <a href="http://sphinx-doc.org/">Sphinx</a> с использованием
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">темы,</a>
    
    предоставленной <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>