Кластер на Cent OS
======================

Основные понятия
"""""""""""""""""""

**Главный узел** – главным узлом будем называть узел, выполняющий маршрутизацию.
Чаще всего, этот узел имеет индекс – 0. Он отличается от остальных узлов, подключением
дополнительных служб и правами доступа.

Установка системы и подготовка служб
""""""""""""""""""""""""""""""""""""""

1. **Установка системы** Установите CentOS с окружением Gnome

2. **Создание пользователя**. На каждой системе создайте пользователей с правами
администратора. Для удобства используйте единый дескриптор для именования пользователей,
например – cn[0-n], где n – количество узлов системы – 1, cn0 – главный узел



3. **Активация сетевых подключений**. Проводное соединение потребуется для межузлового
соединения, беспроводное для подключения к интернету (если вы собираете кластер на
ноутбуке)
Как правило, проводные интерфйсы называются - enp*, беспроводные – wlp*.
Если вы собираете кластер на виртуальной машине, для активации проводного
соединения выберете NAT


4. **Режим суперпользователя**. Во избежании проблем советуется выполнять все команды в
режиме суперпользователя

$ sudo su

5. **Изменение hostname**. Пропишите новое значени параметра hostname, чтобы в
дальнейшем вводить его, а не ip-address узлов. Для удобства можете назвать hostname
аналогично учетной записи системы

$ echo <new-hostname> > /etc/hostname
$ systemctl start systemd-hostnamed

Для проверки воспользуйтесь следующей командой:
$ hostname
 #. Отключение сетевого экрана. Для корректрой работы программ, необходимо отключить
сетевой экран:

$ systemctl stop firewall
$ systemctl disable firewall

6. **Настройка сети**. Это необходимо, для идентификации узлов в системе, сети.
$ ifconfig <interface> 192.168.<space>.[0 ... (n-1)] netmask
255.255.255.0 up, где space – доступное адресное пространство, [0 – (n-1)] – порядковый номер узла (как
при установке значения hostname). Настройка сети должна производится на каждом узле

Определить доступное адресное пространство можно при помощи следующей команды:
$ ifconfig
Выбранное адресное пространство не должно пересекатся с уже занятыми. Это
проверятеся путем просмотра третьей триады ip-address каждого интерфейса.
Проверить корректность настройки можно при помощи следующих команд. Первая
показывает листинг интерфейсов, где должны быть прописаны установленные настройки. Если
настройки применены, введите вторую команду, чтобы проверить корректность сетевого
подключения:
$ ifconfig
$ ping <hostname>

7. **Настройка беспарольного доступа**.
Настройка производится только на главном узле.
$ ssh-keygen -t rsa
Нажимайте enter до тех пор, пока команда не завершит работу. Далее нужно скопировать
содержимое в новый файл. Это делается во избежании переписывания ключа, если в
дальнейшем вам потребуется повторная генерация для других нужд.
$ cat ~/.ssh/id_rsa.pub > ~/.ssh/authorized_keys
Выдаем права доступа:
$ chmod 700 ~/.ssh
$ chmod 644 ~/.ssh/authorized_keys
Копируем содержимое папки, всё, кроме known_hosts, на другие компьютеры:
$ scp ~/.ssh/*d_* <hostname>:~/.ssh

8. **Установка MariaDB**
$ yum install mariadb-server mariadb-devel

9. **Создание расшаренной nfs папки**
На главной узле:
$ yum install epel-release nfs-utils nfs-utils-lib
$ systemctl enable rpcbind nfs-server
$ systemctl start rpcbind nfs-server
Создаём каталог, который будет расшарен, например - /var/nfsvar/var/nfsnfs
$ mkdir /var/nfs$ chmod -R 777 /var/nfs
Создаём шару в файле, - /var/nfsetc/var/nfsexports. Между полем ip-address и значениями в скобках не
должно быть пробелов !
$ echo <ip-address>/n(rw,sync,no_root_squash,no_all_squash) >
/var/exports
ip-address – адрес узла, которому разрешен доступ к расшаренной папке,
n – количество узлов системы.
После создания, перезагружаем конфигурацию, чтобы изменения вступили в силу:
$ exportfs -r
Проверить, опубликованна-ли папка можно при помощи команды:
$ exportfs
На дочерних узлах:
$ yum install epel-release nfs-utils nfs-utils-lib
$ systemctl enable rpcbind
$ systemctl start rpcbind
Создайте каталог, в который будет смонтирован расшаренный каталог. Он должен иметь
идентичный путь на всех машинах:
$ mkdir /var/nfs
$ mount -t nfs <ip-address>:/var/nfs /var/nfs
Для проверки, поместите любой файл в расшаренную папку. Этот файл должен появится
на всех узлах.

Установка Munge и Slurm
"""""""""""""""""""""""""

Сборка MPI
""""""""""""

Запуск параллельной программы
"""""""""""""""""""""""""""""""

Листинг
""""""""""